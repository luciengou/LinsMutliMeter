C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c OMF2 BROWSE DEBUG

line level    source

   1          /***********************************************
   2            PRODUCT FOR NEWCAL MIX_TEMP FUNCTION
   3             CPU : MPC82G516
   4             BEGIN DATE: 2013.11.01
   5             FINISHED  : 2014.01.25
   6             WRITEBY   :JOHNSON LIN
   7             AD111  setup   SET 1001 0000 FOR A0 TYPE 
   8              8CH =  pga =1 ,32767BITS
   9          **************************************************/
  10          #include <MG82FE564.H>
  11          #include <IO_DEFINE.h>
  12          #include <LED.h>
  13          #include <AD3421.h>
  14          #include <DAC6571_mV.h>
  15          #include <DAC6571_mA.h>
  16          #include <MCP79411.h>
  17          #include <EEPROM.H>
  18          #include <STDLIB.H>
  19          #include <TYPE_SLOPE.H>
  20          
  21          #define   BASE_TEMP             32       //F & C Transfor Data
  22          #define   MAX_TEMP              3240     //F 1800C
  23          #define   MAX_VOLT              2048     //mV
  24          #define   EEP_START             60
  25          #define   EEP_END               2000
  26          #define   JOHNSON       0x5a
  27          #define   LIN           0xa5
  28          
  29          #define   K_TYPE                0               //2466F   54.807mV      P0=0x00
  30          #define   J_TYPE                1               //1368F   42.922mV
  31          #define   T_TYPE            2           //360F    9.286mV
  32          #define   E_TYPE                3               //1440F   61.022mV
  33          #define   R_TYPE                4               //2880F   18.842mV
  34          #define   S_TYPE                5               //2880F   16.771mV
  35          #define   B_TYPE                6               //3240F   13.585mV
  36          #define   N_TYPE            7           //?       ?
  37          
  38          #define TC_FUNCTION             0
  39          #define RTD_FUNCTION    1
  40          #define mV_FUNCTION             2
  41          #define mA_FUNCTION             3
  42          #define SETUP_FUNCTION  4
  43          #define CLEAR_FUNCTION  5
  44          
  45          //timer out work select
  46          #define DISPLAY_SEND_TIME  0     // DISPLAY TIME  
  47          #define ADC_READ_TIME      1     //     ADC_READ_TIME
  48          #define RTC_READ_TIME      2     //     RTC_READ_TIME
  49          #define RTC_SEND_TIME      3     //     RTC_SEND_TIME
  50          #define UART_SEND_TIME     4     //     UART_SEND_TIME
  51          #define MV_SEND_TIME       5     // mV_OUT_ TIME
  52          #define SETUP_TIMEOUT      6     //     FAIL_TIMEOUT
  53          #define TIMEUP_TIME        7     //
  54          #define TEMP_TIME          8     //
  55          #define KEY_TIME           9     //
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 2   

  56          
  57          
  58          #define  SQWE           0x40            //  SQWE = b6  
  59          #define  MFP_01H        0x00 
  60          #define  OSC_EN         0x80                    // day bit 7
  61          
  62          #define  sec     0x00  
  63          #define  min     0x01 
  64          #define  hour    0x02
  65          #define  week    0x03
  66          #define  day     0x04
  67          #define  month   0x05
  68          #define  year    0x06
  69          #define  ctl     0x07
  70                             
  71          //EEP Address
  72          #define NOMAL_FUNCTION    0
  73          
  74          #define C_F_CAL           6
  75          #define TYPE_CAL          2
  76          #define TC_ZERO_CAL       3
  77          #define TC_SPAN_CAL       4
  78          #define ALARM_LO_CAL      5
  79          #define ALARM_HI_CAL      6
  80          #define YEAR_DATE_CAL     14
  81          #define MON_DATE_CAL      15
  82          #define DAY_DATE_CAL      16
  83          #define HOUR_DATE_CAL     17
  84          #define MIN_DATE_CAL      18
  85          #define PRODUCT_RESET     19
  86          
  87          #define  C_F_Select  6
  88          #define  Type_Select 7
  89          #define  Zero        8    
  90          #define  Span        10
  91          #define  Slope       12
  92          #define  Year_Date   14
  93          #define  Mon_Date    15
  94          #define  Day_Date    16
  95          #define  Hour_Date   17
  96          #define  Min_Date    18
  97          #define  Hi_Disp     20
  98          #define  Lo_Disp     22
  99          #define  Hi_Input    24
 100          #define  Lo_Input    26
 101          #define  Alarm_Hi    28
 102          #define  Relay_HH    30
 103          #define  Relay_LL    32
 104          #define  Alarm_Low   34
 105          #define  Dot_Point   36
 106          #define  Flash_Disp  37
 107          #define  Zero_Code   38
 108          #define  Sample_Rate 40
 109          #define  ID_Code     41
 110          #define  Lo_Mask     42
 111          #define  Count_Code  44
 112          #define  Gain        45
 113          #define  Transfor    46
 114          #define  Disp_Hi     48
 115          #define  Relay       50
 116          #define  Disp_Count      51
 117          #define  Zero_Set    52
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 3   

 118          #define  Decode_Num  53
 119          #define  Status_flag 54
 120          #define  EEP_ADR     64
 121          //===============================
 122          extern unsigned char key = 0,key_bak = 0,key_d = 0;
 123          extern unsigned char AV_COD ;
 124          extern unsigned char NP_COD ;
 125          unsigned long int value_cal;
 126          
 127          idata unsigned char Soft_Timer[10] = {16,16,4,2,59,2,20,30,2,10};
 128          idata unsigned char T0_cnt,T2_cnt , T1_cnt;
 129          idata unsigned char Temp_Flag = 3 ;
 130          idata unsigned char  t_code = 8 ;
 131          idata unsigned char e0 = 0;
 132          idata unsigned int  CRC_CODE;
 133          idata unsigned char CRC_Hi;
 134          idata unsigned char CRC_Lo;
 135          idata unsigned int  Data_Value[15];
 136          idata unsigned int  Show_Data;
 137          unsigned int reg_crc = 0xffff; 
 138          unsigned int  Temp_sp = 0 ;
 139          unsigned int  Temp_offset = 0 ; 
 140          unsigned int  Temp_m = 0 ;  
 141          unsigned int  Disp_year;
 142          unsigned char  use_flag;
 143          unsigned char NG_COD,ADD_COD;
 144          unsigned char OVER_COD = 0 ;
 145          unsigned char MAIN_SW;
 146          unsigned char Work_Type;
 147          unsigned char C_F_Type;
 148          unsigned char TC_Type;
 149          unsigned int  Zero_offset;
 150          unsigned int  Span_offset;
 151          unsigned int  Span_Value ;
 152          unsigned char  use_year ;
 153          unsigned char  use_mon  ;
 154          unsigned char  use_day  ;
 155          unsigned char  use_week ;
 156          unsigned char  use_hour ;
 157          unsigned char  use_min  ;
 158          unsigned char  use_sec  ;
 159          idata unsigned int   Hi_Disp_Code;
 160          idata unsigned int   Lo_Disp_Code;
 161          idata unsigned int   Hi_Input_Code;
 162          idata unsigned int   Lo_Input_Code;
 163          idata unsigned int  alarm_Hi_set;
 164          idata unsigned int  alarm_HH_set;
 165          idata unsigned int  alarm_LL_set;
 166          idata unsigned int  alarm_Low_set;
 167          idata unsigned char Flash_Time;
 168          idata unsigned int  Zero_Add;
 169          idata unsigned char Uart_Rate;
 170          idata unsigned char Uart_ID;
 171          idata unsigned int  Low_Limit;
 172          idata unsigned char Disp_Neg;
 173          idata unsigned char Disp_Gain;
 174          idata unsigned char Uart_tran;
 175          idata unsigned int  Hi_Limit;
 176          idata unsigned char Relay_ON_OFF;
 177          extern unsigned char Dot_Addr;
 178          extern unsigned char Disp_Bits;
 179          extern unsigned char Disp_Show;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 4   

 180          idata unsigned char Decode_Bit;
 181          unsigned char  n_code = 0 ;
 182          unsigned char CAIT = 0x01;
 183          unsigned char Func_Type;
 184          unsigned char AD_Hi;
 185          unsigned char AD_Mid;
 186          unsigned char AD_Lo;
 187          unsigned char AD_Status;
 188          unsigned char PCB_SETUP;
 189          unsigned char Soft_Timer_Enable = 0;
 190          unsigned char ReceiveDate[10];
 191          
 192          bit f_half_sec;
 193          bit ReceiveFlag = 0;
 194          unsigned char tran = 0 ;
 195          bit Zero_f = 0 ;
 196          /***************************************
 197                     Port In/Out Setting
 198          *****************************************/
 199          void PORT_Init(void)
 200          {
 201   1              P0M0 = 0xFF;      //00=Qb,01=pull output, 10= input only,11=open drain
 202   1              P0M1 = 0x00;     //P0= ALL INPUT  00
 203   1              P0   = 0xff;
 204   1      
 205   1              P1M0 = 0x00;     //P1= ALL OUTPUT//00
 206   1              P1M1 = 0xFF;     //SETUP P1 ALL LO //  define P1.3 P1.4 P1.5 as push-pull
 207   1          P1   = 0x00;
 208   1          
 209   1              P2M0 = 0x24;     //P2= ALL OUTOUT        04 
 210   1              P2M1 |= 0xFF;    //SETUP P2 ALL LO       df
 211   1              P2  =  P2|0x20;
 212   1      
 213   1          P3M0 = 0xED;         //     ed  
 214   1              P3M1 = 0x13;    // 13
 215   1              P3   = 0x2C;    // 2c
 216   1      }
 217          /*******************************************
 218               interrupt   0
 219          *******************************************/
 220          void ex_int0(void) interrupt 0
 221          {;
 222   1      }
 223          /*******************************************
 224               interrupt   1
 225          *******************************************/
 226          void time0(void) interrupt  1     //   T=1/16 sec 
 227          {
 228   1       unsigned int Value_code;
 229   1              TR0 = 0;
 230   1              T1_cnt++;
 231   1              if ((T1_cnt%8)==0)
 232   1              Value_code = SBUF;
 233   1              TH0 = 0x0B;      //0b
 234   1              TL0 = 0xDC;
 235   1              TR0 = 1;
 236   1      }
 237          
 238          /*******************************************
 239               interrupt   3
 240          *******************************************/
 241          void time1(void) interrupt  3   //    T=1/16 sec 
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 5   

 242          {
 243   1              TR1 = 0;
 244   1              T0_cnt++;                                                       
 245   1      
 246   1              if (Soft_Timer[DISPLAY_SEND_TIME] != 0)         Soft_Timer[DISPLAY_SEND_TIME]--;
 247   1              if (Soft_Timer[ADC_READ_TIME] != 0)         Soft_Timer[ADC_READ_TIME]--;
 248   1              if ((T0_cnt%8)==0)      
 249   1                {
 250   2                if (Soft_Timer[RTC_READ_TIME] != 0)   Soft_Timer[RTC_READ_TIME]--;
 251   2                  f_half_sec = 1;
 252   2                }
 253   1              if (T0_cnt == 15)
 254   1              {
 255   2                      T0_cnt = 0;
 256   2                      if (Soft_Timer[UART_SEND_TIME] != 0)    Soft_Timer[UART_SEND_TIME]--;
 257   2                      if (Soft_Timer[MV_SEND_TIME] != 0)          Soft_Timer[MV_SEND_TIME]--;
 258   2                      if (Soft_Timer[SETUP_TIMEOUT] != 0)     Soft_Timer[SETUP_TIMEOUT]--;    
 259   2                      if (Soft_Timer[TIMEUP_TIME] != 0)               Soft_Timer[TIMEUP_TIME]--;
 260   2                      if (Soft_Timer[TEMP_TIME] != 0)             Soft_Timer[TEMP_TIME]--;
 261   2                      if (Soft_Timer[KEY_TIME] != 0)              Soft_Timer[KEY_TIME]--;
 262   2              }               
 263   1              TH1 = 0x0B;
 264   1              TL1 = 0xDC;
 265   1              TR1 = 1;
 266   1       }              
 267          /*******************************************/
 268          void T0_Init(void)
 269          {
 270   1              TR0 = 1;
 271   1              TMOD = 0x11;
 272   1              TH0 = 0x0B;             
 273   1              TL0 = 0xDC;     
 274   1              T0_cnt = 0;
 275   1      }
 276          /*******************************************
 277              
 278          *******************************************/
 279          void T1_Init(void)
 280          {
 281   1              TR1 = 0;
 282   1              TMOD = 0x11;  
 283   1              TH1 = 0x0B;
 284   1              TL1 = 0xDC;
 285   1              T1_cnt = 0;
 286   1       }
 287          /*******************************************
 288              
 289          *******************************************/
 290          void T2_Init(void)
 291          {
 292   1              TR2 = 1;
 293   1              T2MOD = 0x11;  //11  
 294   1              TH2 = 0x0B;
 295   1              TL2 = 0xDC;
 296   1              T2_cnt = 0;
 297   1      }
 298          /*******************************************
 299              
 300          *******************************************/
 301          void INT0_Init(void)
 302          {
 303   1          INT0 = 1;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 6   

 304   1              INT1 = 1;        
 305   1              IE0  = 1;                  
 306   1              IT0  = 1;
 307   1              EX0  = 0;         
 308   1      }
 309          /*******************************************/
 310          void InitUart()    //InitUart use timer2
 311          {
 312   1         SCON |= 0x50;                          /* uart in mode 1 (8 bit), REN=1 50 */
 313   1         T2CON &= 0xF0;               /* EXEN2=0; TR2=0; C/T2#=0; CP/RL2#=0; */
 314   1         T2CON |= 0x30;               /* RCLK = 1; TCLK=1; */
 315   1        if(Uart_Rate == 0)
 316   1          { TH2=0xFE;                    /* init value */
 317   2            TL2=0x80;                    /* init value */
 318   2            RCAP2H=0xFE;                 /* reload value, 1200 Bds at 11.059MHz */
 319   2            RCAP2L=0x80;                 /* reload value, 1200 Bds at 11.059MHz */
 320   2              }
 321   1         else if(Uart_Rate == 1)
 322   1              { TH2=0xFF;                    /* init value */
 323   2            TL2=0x70;                    /* init value */
 324   2            RCAP2H=0xFF;                 /* reload value, 2400 Bds at 11.059MHz */
 325   2            RCAP2L=0x70;                 /* reload value, 2400 Bds at 11.059MHz */
 326   2              }
 327   1         else if(Uart_Rate == 2)
 328   1              { TH2=0xFF;                    /* init value */
 329   2            TL2=0xA0;                    /* init value */
 330   2            RCAP2H=0xFF;                 /* reload value, 4800 Bds at 11.059MHz */
 331   2            RCAP2L=0xA0;                 /* reload value, 4800 Bds at 11.059MHz */
 332   2              }
 333   1         else if(Uart_Rate == 3)
 334   1              { TH2=0xFF;                    /* init value */
 335   2            TL2=0xD0;                    /* init value */
 336   2            RCAP2H=0xFF;                 /* reload value, 9600 Bds at 11.059MHz */
 337   2            RCAP2L=0xDC;                 /* reload value, 9600 Bds at 11.059MHz */
 338   2              }
 339   1         else if(Uart_Rate == 4)
 340   1              { TH2=0xFF;                    /* init value */
 341   2            TL2=0xEE;                    /* init value */
 342   2            RCAP2H=0xFF;                 /* reload value, 19200 Bds at 11.059MHz */
 343   2            RCAP2L=0xEE;                 /* reload value, 19200 Bds at 11.059MHz */
 344   2              }                                                                
 345   1              ES = 1;                                          /* Enable serial interrupt */
 346   1          TR2 = 1;                     /* Timer 2 run */
 347   1      }
 348          /*************************************************/
 349          void serial() interrupt 4
 350          {
 351   1              if(TI==1)
 352   1               {
 353   2                TI = 0 ;
 354   2                }                
 355   1          if(RI==1)
 356   1               {
 357   2                 RI=0;
 358   2                 ReceiveDate[tran] = SBUF;
 359   2                 tran++;
 360   2                 ReceiveFlag = 1;
 361   2               }
 362   1      }
 363          /****************************************/
 364          void delay(unsigned int i)
 365          {
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 7   

 366   1              unsigned char j;
 367   1              for (; i>0; i--)
 368   1                      for (j=0; j<255; j++);
 369   1      }
 370          /*******************************************
 371              
 372          *******************************************/
 373          void Buzzer(unsigned char status)
 374          {
 375   1              if (status)
 376   1            P3 =      P3 |= 0x10;
 377   1              else
 378   1                P3 = P3 &= ~0x10;
 379   1      }
 380          /*******************************************
 381                CHECK PCB TYPE
 382          *******************************************/
 383          void Check_PCB(void)
 384          {
 385   1                 if(P00 == 0)                 //tc
 386   1                   {
 387   2                           Work_Type = 0x00;
 388   2                               Func_Type = 0x00;
 389   2                               PCB_SETUP = 0x01;
 390   2                           if(P04 == 0)               //mV_out
 391   2                             {PCB_SETUP = 0x11 ;}
 392   2                       if(P05 == 0)           //mA_out
 393   2                             {PCB_SETUP = 0x21 ;}
 394   2                               if(use_flag == 0x01) { NG_COD = 1;}
 395   2                       }
 396   1                 else if(P01 == 0)            //rtd
 397   1                       {
 398   2                                Work_Type = 0x01;
 399   2                                Func_Type = 0x01;
 400   2                                  PCB_SETUP = 0x02 ;
 401   2                            if(P04 == 0)      //mV_out
 402   2                              {PCB_SETUP = 0x12 ;}
 403   2                            if(P05 == 0)      //mA_out
 404   2                              {PCB_SETUP = 0x22 ;}
 405   2                                 if(use_flag == 0x02) { NG_COD = 1;}
 406   2                       }
 407   1                else if(P02 == 0)                //mV
 408   1                       {
 409   2                               Work_Type = 0x02 ;
 410   2                               Func_Type = 0x02;
 411   2                                PCB_SETUP = 0x04 ;
 412   2                                if(P04 == 0)         //mV_out
 413   2                              {PCB_SETUP = 0x14 ;}
 414   2                            if(P05 == 0)             //mA_out
 415   2                              {PCB_SETUP = 0x24 ;}
 416   2                                 if(use_flag == 0x04) { NG_COD = 1;}
 417   2                       } 
 418   1                else if(P03 == 0)                //mA
 419   1                       { 
 420   2                           Work_Type = 0x03 ;
 421   2                               Func_Type = 0x03;
 422   2                                 PCB_SETUP = 0x08 ;
 423   2                               if(P04 == 0)           //mV_out
 424   2                             {PCB_SETUP = 0x18 ;}
 425   2                           if(P05 == 0)               //mA_out
 426   2                             {PCB_SETUP = 0x28 ;}
 427   2                               if(use_flag == 0x08) { NG_COD = 1;}  
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 8   

 428   2                       }
 429   1      }
 430          /***********************************************/
 431          unsigned int TEMP_F_TO_C(unsigned int tc_tmp)
 432          {
 433   1       unsigned int ttmp;
 434   1      
 435   1                if(NP_COD == 1)
 436   1                  {
 437   2                       if(tc_tmp >= 32)
 438   2                    {
 439   3                          if(AV_COD == 0)
 440   3                            {
 441   4                              ttmp = (tc_tmp-32)/1.8;
 442   4                            }
 443   3                        else
 444   3                           {
 445   4                                  ttmp = (tc_tmp+32)/1.8; 
 446   4                   }
 447   3                    }
 448   2                  else
 449   2                    {
 450   3                         if(AV_COD == 0)
 451   3                               {
 452   4                         ttmp = (32-tc_tmp)/1.8;
 453   4                                 AV_COD = 1 ;
 454   4                   }
 455   3                         else
 456   3                           {
 457   4                                ttmp = (32+tc_tmp)/1.8;
 458   4                                
 459   4                               }
 460   3                        }
 461   2            }
 462   1          else
 463   1                {               
 464   2                 if(tc_tmp >= 320)
 465   2                    {
 466   3                          if(AV_COD == 0)
 467   3                            {
 468   4                              ttmp = (tc_tmp-320)/1.8;
 469   4                            }
 470   3                        else
 471   3                           {
 472   4                                  ttmp = (tc_tmp+320)/1.8; 
 473   4                   }
 474   3                    }
 475   2                  else
 476   2                    {
 477   3                         if(AV_COD == 0)
 478   3                               {
 479   4                         ttmp = (320-tc_tmp)/1.8;
 480   4                                       AV_COD = 1 ;
 481   4                   }
 482   3                         else
 483   3                           {
 484   4                                ttmp = (320+tc_tmp)/1.8;
 485   4                               }
 486   3                       }
 487   2                 }
 488   1            return(ttmp);
 489   1      }
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 9   

 490          /**********************************************/
 491          void Volt_Ctrl(void)
 492          {
 493   1      }
 494          /*********************************
 495          /***************   27763,58716**************/
 496          unsigned int Temp_Read(void)
 497          {
 498   1      unsigned int Temp_Count,P_count;
 499   1                   TEMP = 1;
 500   1                        P_count = 0;
 501   1                        delay(1);
 502   1                      while(TEMP)
 503   1                         {  P_count = P_count + 1 ;}    
 504   1                          TEMP = 0 ;
 505   1                                      P_count = 0x7d00 - P_count ;                                     
 506   1                           if((P_count < 2329)||(P_count > 0x4fff)){Temp_Count = 0;}          
 507   1                               else{ Temp_Count = (P_count-2329)/36 ; 
 508   2                                         if(Temp_Count > 181)
 509   2                                      { Temp_Count = Temp_Count+(Temp_Count-178)/2 ;
 510   3                                            if(Temp_Count > 252)
 511   3                                          { Temp_Count = Temp_Count+(Temp_Count-250)/6 ;
 512   4                                                if(Temp_Count > 341)
 513   4                                              { Temp_Count = Temp_Count+(Temp_Count-340)/5 ;
 514   5                                                    if(Temp_Count > 430)                        //1212
 515   5                                                   { Temp_Count = Temp_Count+(Temp_Count-430)/3 ;
 516   6                                                        if(Temp_Count > 500)
 517   6                                                       { Temp_Count = Temp_Count+(Temp_Count-500)/4;
 518   7                                                            if(Temp_Count > 590)
 519   7                                                          { Temp_Count = Temp_Count+(Temp_Count-590)/8;
 520   8                                                               if(Temp_Count > 700)
 521   8                                                              { Temp_Count = Temp_Count+(Temp_Count-690)/5;
 522   9                                                                    if(Temp_Count > 760)
 523   9                                                                  { Temp_Count = Temp_Count+(Temp_Count- 760)/5;
 524  10                                                                       if(Temp_Count > 840)
 525  10                                                                     { Temp_Count = Temp_Count+(Temp_Count-840)/3;
 526  11                                                                          if(Temp_Count > 912)
 527  11                                                                        { Temp_Count = Temp_Count+(Temp_Count-910)/6;
 528  12                                                                             if(Temp_Count > 1010)
 529  12                                                                           { Temp_Count = Temp_Count+(Temp_Count-1005)/7;
 530  13                                                                                if(Temp_Count > 1095)
 531  13                                                                              { Temp_Count = Temp_Count+(Temp_Count-1094)/9; //?
 532  14                                                                                                                              if(Temp_Count > 1180)
 533  14                                                                                { Temp_Count = Temp_Count+(Temp_Count-1180)/6;
 534  15                                                                                     if(Temp_Count > 1240)
 535  15                                                                                   { Temp_Count = Temp_Count+(Temp_Count-1230)/4;
 536  16                                                                                       if(Temp_Count > 1276)
 537  16                                                                                     { Temp_Count = Temp_Count+(Temp_Count-1270)/4 ;
 538  17                                                                                          if(Temp_Count > 1420)
 539  17                                                                                        { Temp_Count = Temp_Count+(Temp_Count-1410)/5
             -;
 540  18                                                                                             if(Temp_Count > 1528)
 541  18                                                                                           { Temp_Count = Temp_Count+(Temp_Count-1520
             -)/5;
 542  19                                                                                               if(Temp_Count > 1619)
 543  19                                                                                              { Temp_Count = Temp_Count+(Temp_Count-1
             -610)/4;
 544  20                                                                                                   if(Temp_Count > 1726)
 545  20                                                                                                  { Temp_Count = Temp_Count+(Temp_Cou
             -nt-1720)/16;
 546  21                                                                                                                                                                      }}}}}}}}}} }}}}}}}}     }
 547   2                  }
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 10  

 548   1          return(Temp_Count);
 549   1      }
 550          /*                                                                                                                                                        
 551          unsigned int Temp_Read(void)
 552          {
 553          unsigned int P_count;
 554                            P_count = 37800; //60418; //7a00;              //ec00
 555                      TEMP = 1;
 556                            delay(1);
 557                          while(TEMP)
 558                             { P_count--;}        
 559                              TEMP = 0 ;  
 560                               if(P_count > 32000){P_count = 0;} 
 561          //                              P_count = P_count/122 ;   //27736
 562                               if(P_count < 20500)
 563                                           {    P_count = P_count/12 ;
 564                                                    P_count = P_count/(7-P_count/530);    
 565                                           }       
 566                             else if(P_count < 27200)             //26700                 
 567                                       {  P_count = P_count/10 ;
 568                                                     P_count = P_count/(9 -P_count/453);  
 569                                           }
 570                                  else if(P_count < 29370)                                        
 571                                       { P_count = P_count/9 ;
 572                                                    P_count = P_count/(12 -P_count/347);  
 573                                           }
 574                                  else if(P_count < 30370)                                        
 575                                       { P_count = P_count/8 ;
 576                                                     P_count = P_count/(16 -P_count/281); 
 577                                           }
 578                             else if(P_count < 31000)                                     
 579                                       { P_count = P_count/8 ;
 580                                                     P_count = P_count/(19 -P_count/230); 
 581                                           }
 582                                  Temp_m =  P_count;
 583          //                  Temp_m = ( P_count*5)/9;
 584              return(Temp_m);
 585          }
 586          /**********************************************
 587             M_BUS SYSYEM
 588          **********************************************/
 589          unsigned int CRC_CHECK(void)
 590          {
 591   1                unsigned char i=0, j;
 592   1                         tran = 6;
 593   1            if(tran)
 594   1              {
 595   2                   reg_crc ^= ReceiveDate[i];
 596   2                            i ++;
 597   2                   for (j = 0; j < 8; j++)
 598   2                      {
 599   3                        if (reg_crc & 0x01)
 600   3                           reg_crc = (reg_crc >> 1) ^ 0xA001;
 601   3                       else
 602   3                           reg_crc = reg_crc >> 1;
 603   3                      }
 604   2                                 tran--;
 605   2              }
 606   1            return(reg_crc);
 607   1      }
 608          /************************************************/
 609          unsigned char Get_Key(void)
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 11  

 610          {
 611   1         if(PRO_KEY == 1 && SHIFT_KEY == 1 && COUNT_KEY == 1 && SAVE_KEY == 1) 
 612   1           {
 613   2                  if(key_d == 1)
 614   2                        {key = 0x81 ;
 615   3                         key_d = 0;}
 616   2                      else
 617   2                        {
 618   3                      key &= 0x80;
 619   3                      key_bak = 0;
 620   3                      Soft_Timer[KEY_TIME] = 3;
 621   3                        }
 622   2               }
 623   1          else
 624   1               {
 625   2             if(PRO_KEY == 0)
 626   2               {                                                                                                                                                
 627   3                        if(key == 0)
 628   3                      {
 629   4                        if(Soft_Timer[KEY_TIME] == 0)
 630   4      
 631   4                             {
 632   5                               key = 0xc0 ;
 633   5                               key_bak = 1;
 634   5                                   Soft_Timer[KEY_TIME] = 3;
 635   5                             }
 636   4                      }
 637   3                        else
 638   3                          {
 639   4                       if(key ==0x80)
 640   4                         {
 641   5                                  if(key_bak == 1)
 642   5                                {if(Soft_Timer[KEY_TIME] == 0)
 643   6                              {
 644   7                                key = 0x60 ;
 645   7                                key_bak = 1;
 646   7                                                key_d = 0 ;
 647   7                                    Soft_Timer[KEY_TIME] = 3;
 648   7                              }
 649   6                            }
 650   5                              else
 651   5                                {
 652   6                                      key_d = 1;
 653   6                              key_bak = 1;
 654   6                            }
 655   5                         }
 656   4                     }
 657   3               }
 658   2         else if(SHIFT_KEY == 0)
 659   2           {
 660   3              if(key_bak == 0)
 661   3      
 662   3                        { if(key == 0x80)
 663   4                    {
 664   5                         key = 0x82 ;
 665   5                         key_bak = 1; 
 666   5                        }
 667   4                }
 668   3                       else{key = 0x80;}
 669   3               }
 670   2         else if(COUNT_KEY == 0)
 671   2           {
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 12  

 672   3                    if(key_bak == 0)
 673   3                      {
 674   4                            if( key == 0x80 )
 675   4                     {
 676   5                          key =  0x84;
 677   5                          key_bak = 1; 
 678   5                        }
 679   4                      }
 680   3                         else{key = 0x80;}
 681   3               }
 682   2          else if(SAVE_KEY == 0)               //SET ADC
 683   2           {
 684   3                  if(key_bak == 0)
 685   3                      {
 686   4                            if( key == 0x80 )
 687   4                     {
 688   5                          key =  0x88;
 689   5                          key_bak = 1; 
 690   5                         }
 691   4                          else if( key == 0)
 692   4                             {
 693   5                           if(Soft_Timer[KEY_TIME] == 0)
 694   5                             {
 695   6                               key = 0x10 ;
 696   6                               key_bak = 1;
 697   6                                   Soft_Timer[KEY_TIME] = 3;
 698   6                             }
 699   5                                 }
 700   4                         }
 701   3                 }
 702   2         }
 703   1         return key;
 704   1      }
 705          /*******************************
 706          
 707          ********************************/
 708          unsigned  int DO_TC_TYPE(void)
 709          {
 710   1          unsigned int Code_Value,TC_Value,TT_Value,TA_Value ;
 711   1               unsigned char key;
 712   1      
 713   1            key = Get_Key();
 714   1      
 715   1                if(key == 0xc0)
 716   1                {
 717   2                   Func_Type = 4;
 718   2                }
 719   1                if(key == 0x10)
 720   1                {
 721   2                   Func_Type = 4;
 722   2                }
 723   1         else
 724   1           { 
 725   2                if(Temp_Flag != 0 ){Temp_m = Data_Value[n_code];}
 726   2            if (Soft_Timer[TEMP_TIME] == 0)
 727   2              {
 728   3                        Soft_Timer[TEMP_TIME] = 4;
 729   3                    Data_Value[n_code] = Temp_Read() ;
 730   3                     if(n_code < 4){n_code++;}
 731   3                    else{ Temp_m = (Data_Value[3]/4+Data_Value[2]/4+Data_Value[1]/4+Data_Value[0]/4) ; //4
 732   4                                        n_code = 0 ;
 733   4                                   if(Temp_Flag != 0){Temp_Flag-- ;} }
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 13  

 734   3                      }
 735   2                      if (Soft_Timer[ADC_READ_TIME] == 0) 
 736   2                        {
 737   3                            Soft_Timer[ADC_READ_TIME] = 16;
 738   3                               Data_Value[t_code] = Read_AD3421_Value();
 739   3      
 740   3                               if(t_code < 13)
 741   3                                  {t_code++; Code_Value = Data_Value[13];}
 742   3                               else{ Data_Value[13] = (Data_Value[12]/5+Data_Value[11]/5+Data_Value[10]/5+Data_Value[9]/5+Data_Value[
             -8]/5) ;
 743   4                                        t_code = 8;}
 744   3      
 745   3      
 746   3                          if (TC_Type == K_TYPE)
 747   3                    { 
 748   4                                  Temp_sp =  (Temp_m*13)/10;    //24ok
 749   4                                  TT_Value = Check_Type_Offset(Code_Value); 
 750   4                                  TC_Value = Get_K_Slope(TT_Value);
 751   4                                      TT_Value = TC_Value/7.5 ;
 752   4                                      TA_Value = (TC_Value/38+163) ;
 753   4                        }
 754   3                  else if (TC_Type == J_TYPE)
 755   3                    { 
 756   4                                  Temp_sp = (Temp_m*28)/10;    //30 ok  20
 757   4                                  TT_Value = Check_Type_Offset(Code_Value);
 758   4                                      TC_Value = Get_J_Slope(TT_Value);
 759   4                                  TT_Value = TC_Value/7.5 ;
 760   4                                  TA_Value = (TC_Value/21.4+163) ;
 761   4                        }
 762   3                  else if (TC_Type == T_TYPE)
 763   3                    {
 764   4                                  Temp_sp = (Temp_m*12)/10;     //231.044
 765   4                                  TT_Value = Check_Type_Offset(Code_Value);
 766   4                                  TC_Value = Get_T_Slope(TT_Value);
 767   4                              TT_Value = TC_Value/7.5 ;
 768   4                                      TA_Value = (TC_Value/6+163) ;
 769   4                        }
 770   3                  else if (TC_Type == E_TYPE)
 771   3                    { 
 772   4                                  Temp_sp = (Temp_m*40)/10;   //35 1.54 /0k 14
 773   4                              TT_Value = Check_Type_Offset(Code_Value);
 774   4                                  TC_Value = Get_E_Slope(TT_Value);
 775   4                                  TT_Value = TC_Value/7.5 ;
 776   4                                  TA_Value = (TC_Value/22.5+163) ;
 777   4                        }
 778   3                  else if (TC_Type == R_TYPE)
 779   3                   {  NP_COD = 1;
 780   4                                  Temp_sp = Temp_m/6; //Temp_offset/12;3
 781   4                                      TT_Value = Check_Type_Offset(Code_Value);
 782   4                                  TC_Value = Get_R_Slope(TT_Value);
 783   4                                  TT_Value = TC_Value/7.5 ;
 784   4                                  TA_Value = (TC_Value/44.5+163) ;
 785   4                        }
 786   3                  else if (TC_Type == S_TYPE)
 787   3                    {    NP_COD = 1;
 788   4                                   Temp_sp = Temp_m/6; //Temp_offset/12;3
 789   4                                       TT_Value = Check_Type_Offset(Code_Value);
 790   4                                       TC_Value = Get_S_Slope(TT_Value);
 791   4                                   TT_Value = TC_Value/7.5 ;
 792   4                                       TA_Value = (TC_Value/44.5+163) ;
 793   4                        }
 794   3                          if (C_F_Type == 0)  TC_Value = TEMP_F_TO_C(TC_Value);
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 14  

 795   3                        }
 796   2                  if (Soft_Timer[RTC_READ_TIME] == 0)
 797   2                     {
 798   3                               RTC_READ_SET();
 799   3                               Soft_Timer[RTC_READ_TIME] = 8;
 800   3                         }
 801   2      
 802   2                  if (Soft_Timer[DISPLAY_SEND_TIME] == 0)
 803   2                    {  TC_Value = TC_Value - Zero_Add ;
 804   3                          if(Disp_Gain > 1){TC_Value = TC_Value * Disp_Gain;}
 805   3      
 806   3                               if(TC_Value > Hi_Limit){TC_Value = Hi_Limit;}
 807   3                               if(TC_Value < Low_Limit){TC_Value = Low_Limit;}
 808   3                               if(TC_Value > Hi_Input_Code){TC_Value = Hi_Input_Code;}
 809   3                               if(TC_Value < Lo_Input_Code){TC_Value = Lo_Input_Code;}
 810   3                               if(TC_Value > Hi_Disp_Code){TC_Value = Hi_Disp_Code;}
 811   3                               if(TC_Value < Lo_Disp_Code){TC_Value = Lo_Disp_Code;}
 812   3      
 813   3                                Soft_Timer[DISPLAY_SEND_TIME] = Flash_Time;
 814   3                                 if(Disp_Show == 0 ){LED_Disp(1,TC_Value);}            
 815   3                                 else {LED_Disp(Dot_Addr,TC_Value);}
 816   3                               if(Relay_ON_OFF == 1)
 817   3                               {
 818   4                             if ((TC_Value < alarm_LL_set)||(TC_Value > alarm_HH_set))
 819   4                            { BEEP_OUT = 0; }
 820   4                               }
 821   3                              else
 822   3                               {
 823   4                                if ((TC_Value > alarm_Low_set)||(TC_Value < alarm_Hi_set))
 824   4                                   { BEEP_OUT = 1; }
 825   4                               }
 826   3                        }
 827   2                  if (Soft_Timer[MV_SEND_TIME] == 0)
 828   2                        {
 829   3                         if( P04 == 0) Set_mV(TT_Value);
 830   3                         if( P05 == 0) Set_mA(TA_Value);
 831   3      
 832   3                         Soft_Timer[MV_SEND_TIME] = 16;
 833   3                       }
 834   2                  if (Soft_Timer[UART_SEND_TIME] == 0)
 835   2                   {
 836   3                     if(Uart_tran > 1)
 837   3                          {
 838   4                               ReceiveDate[0] = Uart_tran;
 839   4                               ReceiveDate[1] = 0x06;
 840   4                               ReceiveDate[2] = 0;
 841   4                               ReceiveDate[3] = Uart_ID;
 842   4                               ReceiveDate[4] = TC_Value;
 843   4                               ReceiveDate[5] = TC_Value >> 8;
 844   4                               CRC_CODE = CRC_CHECK();
 845   4                               CRC_Lo = CRC_CODE ;
 846   4                               CRC_Hi = CRC_CODE      >> 8 ;
 847   4                               ReceiveDate[6] = CRC_Lo;
 848   4                               ReceiveDate[7] = CRC_Hi;
 849   4      
 850   4                               if(tran == 0)
 851   4                            {
 852   5                                  SBUF = Uart_ID ;
 853   5                                  tran = 1 ;
 854   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 855   5                        }
 856   4                              else if(tran == 1)
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 15  

 857   4                            {
 858   5                                  SBUF = 0x06 ;
 859   5                                  tran = 2 ;
 860   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 861   5                        }
 862   4                              else if(tran == 2)
 863   4                            {
 864   5                                  SBUF = 0 ;
 865   5                                  tran = 3 ;
 866   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 867   5                        }
 868   4                              else if(tran == 3)
 869   4                            {
 870   5                                  SBUF = Uart_ID ;
 871   5                                  tran = 4 ;
 872   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 873   5                        }
 874   4                          else if(tran == 4)
 875   4                            {
 876   5                                  SBUF = TC_Value ;
 877   5                                  tran = 5 ;
 878   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 879   5                        }  
 880   4                              else if(tran == 5)
 881   4                            {
 882   5                                  SBUF = TC_Value >> 8 ;
 883   5                                  tran = 6 ;
 884   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 885   5                        }
 886   4                              else if(tran == 6)
 887   4                            {
 888   5                                  SBUF = CRC_Lo ;
 889   5                                  tran = 7 ;
 890   5                                  Soft_Timer[UART_SEND_TIME] = 1;
 891   5                        }
 892   4                      else if(tran == 7)
 893   4                        { 
 894   5                          SBUF = CRC_Hi;
 895   5                          tran = 0;
 896   5                                  Soft_Timer[UART_SEND_TIME] = 59 ;
 897   5                            }
 898   4                   TI = 1;
 899   4                     }
 900   3                         else{ Soft_Timer[UART_SEND_TIME] = 59 ;}
 901   3                       }
 902   2               }
 903   1          return  TC_Value;
 904   1      }
 905          /*************************************************************************************/
 906          unsigned int Check_Type_Offset(unsigned int Code_Value)
 907          {
 908   1          unsigned int Count_Value;
 909   1           if (NG_COD == 0)
 910   1             {
 911   2                  if (AV_COD == 0)
 912   2                        {
 913   3                         if(Code_Value >= Zero_offset)           
 914   3                           {
 915   4                          Count_Value = (Code_Value - Zero_offset) + Temp_sp ;
 916   4                           }
 917   3                         else   
 918   3                       {
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 16  

 919   4                                  if((Temp_sp + Code_Value) >= Zero_offset)
 920   4                                { Code_Value = (Code_Value + Temp_sp) - Zero_offset ;}
 921   4                      else     
 922   4                                    { Code_Value = ( Zero_offset - Code_Value) + Temp_sp; AV_COD = 1;}
 923   4                               }
 924   3                         }
 925   2                      else   //AV_COD == 1
 926   2                     {
 927   3                               if(( Code_Value +  Zero_offset ) >= Temp_sp)
 928   3                                 { Count_Value = (Code_Value + Zero_offset) - Temp_sp ;}
 929   3                               else
 930   3                                 { Count_Value = (Temp_sp - Code_Value) - Zero_offset;
 931   4                                   AV_COD = 0 ;} 
 932   3                         }                                                                                                             
 933   2                      }
 934   1             else
 935   1                  {
 936   2                   if(AV_COD == 0)  // AV_COD = 0      NG_COD = 1
 937   2                         {
 938   3                            Count_Value = Code_Value + Zero_offset + Temp_sp;
 939   3                         }
 940   2                else    // AV_COD = 1  NG_COD = 1
 941   2                     {
 942   3                           if( Code_Value >= Zero_offset ) 
 943   3                                 {
 944   4                                  if((Temp_sp + Zero_offset ) >= Code_Value)
 945   4                                        {
 946   5                                           Count_Value = (Temp_sp + Zero_offset ) - Code_Value; AV_COD = 0;
 947   5                                        }
 948   4                                       else
 949   4                                    { Count_Value = Code_Value - (Temp_sp + Zero_offset);} 
 950   4                                 }
 951   3                               else
 952   3                                 {
 953   4                                       if(( Zero_offset - Code_Value ) >= Temp_sp  )
 954   4                                         {
 955   5                                               Count_Value = Zero_offset - (Temp_sp + Code_Value); AV_COD = 0;
 956   5                                         } 
 957   4                                       else
 958   4                                         { Count_Value = (Zero_offset - Code_Value) + Temp_sp  ;  AV_COD = 0;}
 959   4      
 960   4                                 }                                                                                                               
 961   3                         }
 962   2                 }
 963   1      
 964   1         if(ADD_COD == 1 ) 
 965   1               { Count_Value = Count_Value - (Count_Value/Span_Value); }        //TC_Span_Value
 966   1         else
 967   1               { Count_Value = Count_Value + (Count_Value/Span_Value);}
 968   1                 
 969   1              if(OVER_COD == 1){ Count_Value = 0xffff;}
 970   1      
 971   1        return Count_Value;
 972   1      }
 973          /***********************************************
 974          RTD=  2 27.6    40      48      56      58
 975          131072                                  
 976          3200 2600 1950    950  40
 977          1300 2200  3250  4100    5000 5750      6450
 978          7350 7950  8700  9300  9900     10500    11150
 979          11700 12300     12850   13400 
 980          *************************************************/
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 17  

 981          unsigned int DO_RTD_TYPE(void)
 982          {
 983   1        unsigned int RTD_Value; 
 984   1        unsigned char key;     
 985   1      
 986   1            key = Get_Key();
 987   1               
 988   1                if(key == 0xc0)
 989   1                {
 990   2                   Func_Type =  4;
 991   2                }
 992   1               if(key == 0x10)
 993   1                {
 994   2                   Func_Type = 4;
 995   2                }
 996   1              else
 997   1                {
 998   2                  if (Soft_Timer[ADC_READ_TIME] == 0) 
 999   2                        {
1000   3                               Soft_Timer[ADC_READ_TIME] = 16;
1001   3      
1002   3                                RTD_Value = Read_AD3421_Value();
1003   3      
1004   3                               if((NG_COD == 1)&&(AV_COD == 1))
1005   3                                 {
1006   4                                                if( RTD_Value >= Zero_offset)
1007   4                                                  {
1008   5                                                   RTD_Value = RTD_Value - Zero_offset;
1009   5                                                      }
1010   4                                                 else
1011   4                                                  {
1012   5                                                       RTD_Value = Zero_offset -RTD_Value;
1013   5                                                       AV_COD = 0;
1014   5                                                      }
1015   4                                      }
1016   3                                else if((NG_COD == 1)&&(AV_COD == 0))
1017   3                                  {
1018   4                                                   RTD_Value = RTD_Value + Zero_offset;
1019   4                                  }                   
1020   3                                else if((NG_COD == 0)&&(AV_COD == 1))
1021   3                                  {
1022   4                                                   RTD_Value = RTD_Value + Zero_offset;
1023   4                                  }   
1024   3                                else if((NG_COD == 0)&&(AV_COD == 0))
1025   3                                  {
1026   4                                             if( RTD_Value >= Zero_offset)
1027   4                                                  {
1028   5                                                   RTD_Value = RTD_Value - Zero_offset;
1029   5                                                      }
1030   4                                                 else
1031   4                                                  {
1032   5                                                       RTD_Value = Zero_offset -RTD_Value;
1033   5                                                   AV_COD = 1 ;
1034   5                                                      }
1035   4                                      }
1036   3                                         if(Span_offset > 0x44e4)
1037   3                                               {  RTD_Value = RTD_Value +(RTD_Value/Span_Value);}
1038   3                                        else
1039   3                                               {  RTD_Value = RTD_Value - (RTD_Value/Span_Value);}
1040   3                                       if(OVER_COD == 1) RTD_Value = 0xffff;
1041   3                    RTD_Value = Get_RTD_Slope(RTD_Value);
1042   3       
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 18  

1043   3                       if (C_F_Type == 0)     RTD_Value = TEMP_F_TO_C(RTD_Value);
1044   3                     }
1045   2               if (Soft_Timer[DISPLAY_SEND_TIME] == 0)
1046   2                 {     
1047   3                           RTD_Value = RTD_Value - Zero_Add ;
1048   3                               if(Disp_Gain > 1){RTD_Value = RTD_Value * Disp_Gain;}
1049   3                               if(RTD_Value > Hi_Limit){RTD_Value = Hi_Limit;}
1050   3                               if(RTD_Value < Low_Limit){RTD_Value = Low_Limit;}
1051   3                               if(RTD_Value > Hi_Input_Code){RTD_Value = Hi_Input_Code;}
1052   3                               if(RTD_Value < Lo_Input_Code){RTD_Value = Lo_Input_Code;}
1053   3                           if(RTD_Value > Hi_Disp_Code){RTD_Value = Hi_Disp_Code;}
1054   3                               if(RTD_Value < Lo_Disp_Code){RTD_Value = Lo_Disp_Code;}
1055   3                               if(Disp_Show == 0 ){LED_Disp(1,RTD_Value);}             
1056   3                               else {LED_Disp(Dot_Addr,RTD_Value);}
1057   3                         Soft_Timer[DISPLAY_SEND_TIME] = Flash_Time ; 
1058   3      
1059   3                          if(Relay_ON_OFF == 1)
1060   3                               {
1061   4                             if ((RTD_Value  < alarm_LL_set)||(RTD_Value  > alarm_HH_set))
1062   4                            { BEEP_OUT = 0; }
1063   4                               }
1064   3                              else
1065   3                               {
1066   4                                if ((RTD_Value  > alarm_Low_set)||(RTD_Value  < alarm_Hi_set))
1067   4                                   { BEEP_OUT = 1; }
1068   4                           }
1069   3                        }
1070   2                  if (Soft_Timer[MV_SEND_TIME] == 0)
1071   2                    {
1072   3                         if( P04 == 0) Set_mV(RTD_Value);
1073   3                         if( P05 == 0) Set_mA(RTD_Value);
1074   3      
1075   3                         Soft_Timer[MV_SEND_TIME] = 2;
1076   3                        }
1077   2                  if (Soft_Timer[RTC_READ_TIME] == 0)
1078   2                   {
1079   3                         RTC_READ_SET();
1080   3                         Soft_Timer[RTC_READ_TIME] = 8 ;
1081   3                       }
1082   2                  if (Soft_Timer[UART_SEND_TIME] == 0)
1083   2                    {
1084   3                       if(Uart_tran > 1)
1085   3                          {
1086   4                               ReceiveDate[0] = Uart_tran;
1087   4                               ReceiveDate[1] = 0x06;
1088   4                               ReceiveDate[2] = 0;
1089   4                               ReceiveDate[3] = Uart_ID;
1090   4                               ReceiveDate[4] = RTD_Value;
1091   4                               ReceiveDate[5] = RTD_Value >> 8;
1092   4                               CRC_CODE = CRC_CHECK();
1093   4                               CRC_Lo = CRC_CODE ;
1094   4                               CRC_Hi = CRC_CODE      >> 8 ;
1095   4                               ReceiveDate[6] = CRC_Lo;
1096   4                               ReceiveDate[7] = CRC_Hi;
1097   4      
1098   4                               if(tran == 0)
1099   4                            {
1100   5                                  SBUF = Uart_ID ;
1101   5                                  tran = 1 ;
1102   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1103   5                        }
1104   4                              else if(tran == 1)
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 19  

1105   4                            {
1106   5                                  SBUF = 0x06 ;
1107   5                                  tran = 2 ;
1108   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1109   5                        }
1110   4                              else if(tran == 2)
1111   4                            {
1112   5                                  SBUF = 0 ;
1113   5                                  tran = 3 ;
1114   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1115   5                        }
1116   4                              else if(tran == 3)
1117   4                            {
1118   5                                  SBUF = Uart_ID ;
1119   5                                  tran = 4 ;
1120   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1121   5                        }
1122   4                          else if(tran == 4)
1123   4                            {
1124   5                                  SBUF = RTD_Value ;
1125   5                                  tran = 5 ;
1126   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1127   5                        }  
1128   4                              else if(tran == 5)
1129   4                            {
1130   5                                  SBUF = RTD_Value >> 8 ;
1131   5                                  tran = 6 ;
1132   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1133   5                        }
1134   4                              else if(tran == 6)
1135   4                            {
1136   5                                  SBUF = CRC_Lo ;
1137   5                                  tran = 7 ;
1138   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1139   5                        }
1140   4                      else if(tran == 7)
1141   4                        { 
1142   5                          SBUF = CRC_Hi;
1143   5                          tran = 0;
1144   5                                  Soft_Timer[UART_SEND_TIME] = 59 ;
1145   5                            }
1146   4                   TI = 1;
1147   4                     }
1148   3                         else{ Soft_Timer[UART_SEND_TIME] = 59 ;}
1149   3                       
1150   3             }
1151   2              }
1152   1         return RTD_Value;
1153   1      }
1154          /***********************************************
1155          
1156          ************************************************/
1157          unsigned  int DO_mV_TYPE(void)
1158          {
1159   1           unsigned int mV_Value;
1160   1               unsigned char key;
1161   1      
1162   1            key = Get_Key();
1163   1               
1164   1                if(key == 0xc0)
1165   1                  {
1166   2                    Func_Type = 4;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 20  

1167   2                  }
1168   1                if(key == 0x10)
1169   1                  {
1170   2                   Func_Type = 4;
1171   2                  }
1172   1                else 
1173   1                  {
1174   2                       if (Soft_Timer[ADC_READ_TIME] == 0) 
1175   2                        {
1176   3                          Soft_Timer[ADC_READ_TIME] = 16;
1177   3      
1178   3                          mV_Value = Read_AD3421_Value();
1179   3      
1180   3                               
1181   3                               if((NG_COD == 1)&&(AV_COD == 1))
1182   3                                 {
1183   4                                                if( mV_Value > Zero_offset)           
1184   4                                                  {
1185   5                                                   mV_Value = mV_Value - Zero_offset;
1186   5                                                      }
1187   4                                                 else
1188   4                                                  {
1189   5                                                       mV_Value = Zero_offset -mV_Value;
1190   5                                                       AV_COD = 0;
1191   5                                                      }
1192   4                                      }
1193   3                                else if((NG_COD == 1)&&(AV_COD == 0))
1194   3                                  {
1195   4                                                   mV_Value = mV_Value + Zero_offset;
1196   4                                  }                   
1197   3                                else if((NG_COD == 0)&&(AV_COD == 1))
1198   3                                  {
1199   4                                                   mV_Value = mV_Value + Zero_offset;
1200   4                                  }   
1201   3                                else if((NG_COD == 0)&&(AV_COD == 0))
1202   3                                  {
1203   4                                             if( mV_Value >= Zero_offset)
1204   4                                                  {
1205   5                                                   mV_Value = mV_Value - Zero_offset;
1206   5                                                      }
1207   4                                                 else
1208   4                                                  {
1209   5                                                       mV_Value = Zero_offset -mV_Value;
1210   5                                                   AV_COD = 1 ;
1211   5                                                      }
1212   4                                      }
1213   3                                         if(Span_offset > 0x0c80)
1214   3                                               { mV_Value = mV_Value + (mV_Value/Span_Value); }
1215   3                                        else
1216   3                                               { mV_Value = mV_Value - (mV_Value/Span_Value); }
1217   3      
1218   3                                     mV_Value = mV_Value/3.2;
1219   3                              if(OVER_COD == 1) mV_Value = 0xffff;     
1220   3                       }
1221   2                 if (Soft_Timer[DISPLAY_SEND_TIME] == 0)
1222   2                   {  
1223   3                              mV_Value = mV_Value - Zero_Add ;
1224   3                          if(Disp_Gain > 1){mV_Value = mV_Value * Disp_Gain;}
1225   3                              if(mV_Value > Hi_Limit){mV_Value = Hi_Limit;}
1226   3                              if(mV_Value < Low_Limit){mV_Value = Low_Limit;}
1227   3                          if(mV_Value > Hi_Input_Code){mV_Value = Hi_Input_Code;}
1228   3                              if(mV_Value < Lo_Input_Code){mV_Value = Lo_Input_Code;}
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 21  

1229   3                          if(mV_Value > Hi_Disp_Code){mV_Value = Hi_Disp_Code;}
1230   3                              if(mV_Value < Lo_Disp_Code){mV_Value = Lo_Disp_Code;}
1231   3                               if(Disp_Show == 0){LED_Disp(1,mV_Value);}               
1232   3                               else {LED_Disp(Dot_Addr,mV_Value);}
1233   3                          Soft_Timer[DISPLAY_SEND_TIME] = Flash_Time ;
1234   3      
1235   3                          if(Relay_ON_OFF == 1)
1236   3                               {
1237   4                             if ((mV_Value  < alarm_LL_set)||(mV_Value  > alarm_HH_set))
1238   4                            { BEEP_OUT = 0; }
1239   4                               }
1240   3                              else
1241   3                               {
1242   4                                if ((mV_Value > alarm_Low_set)||(mV_Value  < alarm_Hi_set))
1243   4                                   { BEEP_OUT = 1; }
1244   4                           }
1245   3                        }
1246   2                 if (Soft_Timer[MV_SEND_TIME] == 0)
1247   2                   {
1248   3                         if( P04 == 0)  Set_mV(mV_Value);
1249   3                         if( P05 == 0)  Set_mA(mV_Value);
1250   3      
1251   3                         Soft_Timer[MV_SEND_TIME] = 2;
1252   3                       }
1253   2                if (Soft_Timer[RTC_READ_TIME] == 0)
1254   2                  {
1255   3                        RTC_READ_SET();
1256   3                        Soft_Timer[RTC_READ_TIME] = 8 ;
1257   3                      }
1258   2                 if (Soft_Timer[UART_SEND_TIME] == 0)
1259   2                   {
1260   3                        if(Uart_tran > 1)
1261   3                          {
1262   4                               ReceiveDate[0] = Uart_tran;
1263   4                               ReceiveDate[1] = 0x06;
1264   4                               ReceiveDate[2] = 0;
1265   4                               ReceiveDate[3] = Uart_ID;
1266   4                               ReceiveDate[4] = mV_Value;
1267   4                               ReceiveDate[5] = mV_Value >> 8;
1268   4                               CRC_CODE = CRC_CHECK();
1269   4                               CRC_Lo = CRC_CODE ;
1270   4                               CRC_Hi = CRC_CODE      >> 8 ;
1271   4                               ReceiveDate[6] = CRC_Lo;
1272   4                               ReceiveDate[7] = CRC_Hi;
1273   4      
1274   4                               if(tran == 0)
1275   4                            {
1276   5                                  SBUF = Uart_ID ;
1277   5                                  tran = 1 ;
1278   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1279   5                        }
1280   4                              else if(tran == 1)
1281   4                            {
1282   5                                  SBUF = 0x06 ;
1283   5                                  tran = 2 ;
1284   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1285   5                        }
1286   4                              else if(tran == 2)
1287   4                            {
1288   5                                  SBUF = 0 ;
1289   5                                  tran = 3 ;
1290   5                                  Soft_Timer[UART_SEND_TIME] = 1;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 22  

1291   5                        }
1292   4                              else if(tran == 3)
1293   4                            {
1294   5                                  SBUF = Uart_ID ;
1295   5                                  tran = 4 ;
1296   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1297   5                        }
1298   4                          else if(tran == 4)
1299   4                            {
1300   5                                  SBUF = mV_Value ;
1301   5                                  tran = 5 ;
1302   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1303   5                        }  
1304   4                              else if(tran == 5)
1305   4                            {
1306   5                                  SBUF = mV_Value >> 8 ;
1307   5                                  tran = 6 ;
1308   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1309   5                        }
1310   4                              else if(tran == 6)
1311   4                            {
1312   5                                  SBUF = CRC_Lo ;
1313   5                                  tran = 7 ;
1314   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1315   5                        }
1316   4                      else if(tran == 7)
1317   4                        { 
1318   5                          SBUF = CRC_Hi;
1319   5                          tran = 0;
1320   5                                  Soft_Timer[UART_SEND_TIME] = 59 ;
1321   5                            }
1322   4                   TI = 1;
1323   4                     }
1324   3                         else{ Soft_Timer[UART_SEND_TIME] = 59 ;}
1325   3                       }
1326   2                }
1327   1               return mV_Value ;
1328   1      }
1329          /***********************************************
1330          
1331          *************************************************/
1332          unsigned int DO_mA_TYPE(void)
1333          {
1334   1           unsigned int mA_Value;
1335   1               unsigned char key;
1336   1      
1337   1            key = Get_Key();
1338   1               
1339   1                if(key == 0xc0)
1340   1                  {
1341   2                    Func_Type = 4 ;
1342   2                  }
1343   1                      if(key == 0x10)
1344   1                {
1345   2                   Func_Type = 4;
1346   2                }
1347   1                else 
1348   1                  {
1349   2                       if (Soft_Timer[ADC_READ_TIME] == 0) 
1350   2                         {
1351   3                                   Soft_Timer[ADC_READ_TIME] = 16;
1352   3      
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 23  

1353   3                                       mA_Value = Read_AD3421_Value();
1354   3      
1355   3                               if((NG_COD == 1)&&(AV_COD == 1))
1356   3                                 {
1357   4                                                if( mA_Value >= Zero_offset)
1358   4                                                  {
1359   5                                                   mA_Value = mA_Value - Zero_offset;
1360   5                                                      }
1361   4                                                 else
1362   4                                                  {
1363   5                                                       mA_Value = Zero_offset -mA_Value;
1364   5                                                       AV_COD = 0;
1365   5                                                      }
1366   4                                      }
1367   3                                else if((NG_COD == 1)&&(AV_COD == 0))
1368   3                                  {
1369   4                                                   mA_Value = mA_Value + Zero_offset;
1370   4                                  }                   
1371   3                                else if((NG_COD == 0)&&(AV_COD == 1))
1372   3                                  {
1373   4                                                   mA_Value = mA_Value + Zero_offset;
1374   4                                  }   
1375   3                                else if((NG_COD == 0)&&(AV_COD == 0))
1376   3                                  {
1377   4                                             if( mA_Value >= Zero_offset)
1378   4                                                  {
1379   5                                                   mA_Value = mA_Value - Zero_offset;
1380   5                                                      }
1381   4                                                 else
1382   4                                                  {
1383   5                                                       mA_Value = Zero_offset -mA_Value;
1384   5                                                   AV_COD = 1 ;
1385   5                                                      }
1386   4                                      }
1387   3                                         if(Span_offset >  0x1900)
1388   3                                               { mA_Value = mA_Value + (mA_Value/Span_Value); }
1389   3                                        else
1390   3                                               { mA_Value = mA_Value - (mA_Value/Span_Value); }
1391   3      
1392   3                                       mA_Value = mA_Value/3.2 ;
1393   3      
1394   3                                       if(OVER_COD == 1) mA_Value = 0xffff;
1395   3                        }
1396   2                 if (Soft_Timer[DISPLAY_SEND_TIME] == 0)
1397   2                   {   
1398   3                           mA_Value = mA_Value - Zero_Add;
1399   3                               if(Disp_Gain > 1){mA_Value = mA_Value * Disp_Gain;}
1400   3                           if(mA_Value > Hi_Limit){mA_Value = Hi_Limit;}
1401   3                               if(mA_Value < Low_Limit){mA_Value = Low_Limit;}
1402   3                               if(mA_Value > Hi_Input_Code){mA_Value = Hi_Input_Code;}
1403   3                               if(mA_Value < Lo_Input_Code){mA_Value = Lo_Input_Code;}
1404   3                           if(mA_Value > Hi_Disp_Code){mA_Value = Hi_Disp_Code;}
1405   3                               if(mA_Value < Lo_Disp_Code){mA_Value = Lo_Disp_Code;}
1406   3                                if(Disp_Show == 0 ){LED_Disp(2,mA_Value);}             
1407   3                               else {LED_Disp(Dot_Addr,mA_Value);}
1408   3                          Soft_Timer[DISPLAY_SEND_TIME] = Flash_Time ;
1409   3      
1410   3                          if(Relay_ON_OFF == 1)
1411   3                               {
1412   4                             if ((mA_Value  < alarm_LL_set)||(mA_Value  > alarm_HH_set))
1413   4                            { BEEP_OUT = 0; }
1414   4                               }
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 24  

1415   3                              else
1416   3                               {
1417   4                                if ((mA_Value > alarm_Low_set)||(mA_Value  < alarm_Hi_set))
1418   4                                   { BEEP_OUT = 1; }
1419   4                           }
1420   3               }
1421   2                 if (Soft_Timer[MV_SEND_TIME] == 0)
1422   2                   {
1423   3                         if( P04 == 0)  Set_mV(mA_Value);
1424   3                         if( P05 == 0)  Set_mA(mA_Value);
1425   3      
1426   3                         Soft_Timer[MV_SEND_TIME] = 2;
1427   3                       }
1428   2                 if (Soft_Timer[RTC_READ_TIME] == 0)
1429   2                  {
1430   3                        RTC_READ_SET();
1431   3                        Soft_Timer[RTC_READ_TIME] = 8 ;
1432   3                      }
1433   2                 if (Soft_Timer[UART_SEND_TIME] == 0)
1434   2                   {
1435   3                        if(Uart_tran > 1)
1436   3                          {
1437   4                               ReceiveDate[0] = Uart_tran;
1438   4                               ReceiveDate[1] = 0x06;
1439   4                               ReceiveDate[2] = 0;
1440   4                               ReceiveDate[3] = Uart_ID;
1441   4                               ReceiveDate[4] = mA_Value;
1442   4                               ReceiveDate[5] = mA_Value >> 8;
1443   4                               CRC_CODE = CRC_CHECK();
1444   4                               CRC_Lo = CRC_CODE ;
1445   4                               CRC_Hi = CRC_CODE      >> 8 ;
1446   4                               ReceiveDate[6] = CRC_Lo;
1447   4                               ReceiveDate[7] = CRC_Hi;
1448   4      
1449   4                               if(tran == 0)
1450   4                            {
1451   5                                  SBUF = Uart_ID ;
1452   5                                  tran = 1 ;
1453   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1454   5                        }
1455   4                              else if(tran == 1)
1456   4                            {
1457   5                                  SBUF = 0x06 ;
1458   5                                  tran = 2 ;
1459   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1460   5                        }
1461   4                              else if(tran == 2)
1462   4                            {
1463   5                                  SBUF = 0 ;
1464   5                                  tran = 3 ;
1465   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1466   5                        }
1467   4                              else if(tran == 3)
1468   4                            {
1469   5                                  SBUF = Uart_ID ;
1470   5                                  tran = 4 ;
1471   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1472   5                        }
1473   4                          else if(tran == 4)
1474   4                            {
1475   5                                  SBUF = mA_Value ;
1476   5                                  tran = 5 ;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 25  

1477   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1478   5                        }  
1479   4                              else if(tran == 5)
1480   4                            {
1481   5                                  SBUF = mA_Value >> 8 ;
1482   5                                  tran = 6 ;
1483   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1484   5                        }
1485   4                              else if(tran == 6)
1486   4                            {
1487   5                                  SBUF = CRC_Lo ;
1488   5                                  tran = 7 ;
1489   5                                  Soft_Timer[UART_SEND_TIME] = 1;
1490   5                        }
1491   4                      else if(tran == 7)
1492   4                        { 
1493   5                          SBUF = CRC_Hi;
1494   5                          tran = 0;
1495   5                                  Soft_Timer[UART_SEND_TIME] = 59 ;
1496   5                            }
1497   4                   TI = 1;
1498   4                     }
1499   3                         else{ Soft_Timer[UART_SEND_TIME] = 59 ;}
1500   3                       }
1501   2               }
1502   1        return mA_Value;
1503   1      }
1504          /*************************************************/
1505          unsigned int Read_AD3421_Value(void)
1506          {
1507   1         unsigned int  AD3421_Value;
1508   1         unsigned char ssta;
1509   1      
1510   1                       ssta = Get_AD3421_Value();
1511   1                if (ssta == 0)
1512   1                  {
1513   2                               AD_Hi =  AD_Hi & 0x03;
1514   2                    if(AD_Hi >= 2)
1515   2                         {
1516   3                            AV_COD = 1;
1517   3                                AD3421_Value = AD_Hi & 0x03;    
1518   3                                AD3421_Value = AD3421_Value << 8 ;
1519   3                                AD3421_Value = AD3421_Value + AD_Mid ;
1520   3                                AD3421_Value = AD3421_Value << 7 ;
1521   3                                AD_Lo = AD_Lo >> 1;
1522   3                                AD3421_Value = AD3421_Value + AD_Lo ;  
1523   3                                AD3421_Value = ~ AD3421_Value; 
1524   3                                if( AD3421_Value >= 0xf000){OVER_COD = 1;} else{OVER_COD = 0;}
1525   3                         }
1526   2                        else
1527   2                         {
1528   3                                AV_COD = 0;
1529   3                                AD3421_Value = AD_Hi & 0x03;    
1530   3                                AD3421_Value = AD3421_Value << 8 ;
1531   3                                AD3421_Value = AD3421_Value + AD_Mid ;
1532   3                                AD3421_Value = AD3421_Value << 7 ;
1533   3                                AD_Lo = AD_Lo >> 1;
1534   3                                AD3421_Value = AD3421_Value + AD_Lo;
1535   3                                if( AD3421_Value >= 0xf000){OVER_COD = 1;} else{OVER_COD = 0;}
1536   3                         }
1537   2                 }
1538   1         return AD3421_Value;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 26  

1539   1      }
1540          /************************************************************
1541          CP00     PS     vKX   SEC
1542                   ]w  HS MODE
1543          //------------------------------------------------------------
1544          CP01 ]w C_F  
1545          CP02 ]w  TC TYPE
1546          CP03  ZERO OFFSET
1547          CP04  SPAN OFFSET
1548          CP05 ]w YEAR_DATE     
1549          CP06 ]w MON_DATE      
1550          CP07 ]w DAY_DATE      
1551          CP08 ]w HOUR_DATE     
1552          CP09 ]w MIN_DATE      
1553          
1554          UP10 ]w  HS
1555          UP11 ]wC  LS
1556          UP12 ]wJ  RH
1557          UP13 ]wCJ  RL
1558          UP14 RELAY HI I HI
1559          UP15 RELAY HH I HH
1560          UP16 RELAY LL I LL
1561          UP17 RELAY LO I LO
1562          UP18 pIm  D0 0=L 1= 2=B 3=...(L)
1563          UP19 s]w DT  0 ~ 9S
1564          UP20 s ]w  OF  +XXX ~ - XXX
1565          UP21 SAMPLE RATE SET BU  0 ~4, 1200/2400/4800/9600/19200
1566          UP22 ID CODE ID   0 ~99
1567          UP23 CIB  LD  
1568          UP24 i]w  CD 0 ~ 9
1569          UP25 ]w  DB  00,01= 1   02= 2 03=3
1570          UP26 D]w  MS  00 = D(e), 01=(e), 02=DDe,03=De
1571          UP27 ]w  HD  ,
1572          UP28 RELAY   RS      1 = ON , 0 = OFF,
1573          UP29 ]w DS  2 ~ 6
1574          UP30 e]w CL   1 = 0, 0=n(U 0.0~0.9)
1575          UP31 JR  RT  12/14/16 )
1576          ***************************************************************/ 
1577          void DO_SETUP_TYPE(void)
1578          {
1579   1              unsigned char set_key = 0, times = 5, cont1 = 0,Vert = 0, Itemm = 0, Flag_Read = 0; //
1580   1              unsigned char pro_key,sele_key,add_key,adc_key;
1581   1      
1582   1                      SETUP_LED_Disp(0,Itemm);
1583   1      
1584   1               while (CAIT)
1585   1                       {
1586   2                      set_key = Get_Key();       //60,81,82,84,             //10
1587   2      
1588   2                                if((set_key & 0x60) == 0x60)  // pro key
1589   2                                     {
1590   3                                          CAIT=0;
1591   3                                     }
1592   2                                else
1593   2                                     {
1594   3                                             if((set_key & 0x81) == 0x81)       //set in & set out
1595   3                                               {
1596   4                                                                  pro_key = 1;
1597   4                                                                  if(Itemm == 0){Itemm = 1;}
1598   4                                                      else{Itemm = 2;}
1599   4                                               }
1600   3                                             else
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 27  

1601   3                                               { pro_key = 0 ;}
1602   3                                               //==================================
1603   3                                             if((set_key & 0x82) == 0x82)        //shift 
1604   3                                               { sele_key = 1 ;}
1605   3                                              else
1606   3                                               { sele_key = 0 ;}
1607   3                                          //===================================
1608   3                                             if((set_key & 0x84) == 0x84)        //add /next item
1609   3                                                            { 
1610   4                                                                 if(Itemm >= 1)
1611   4                                                                   {
1612   5                                                                    add_key = 1;
1613   5                                                                       }
1614   4                                                                 else
1615   4                                                                   { 
1616   5                                                                          if(Vert == 1)
1617   5                                                                                {
1618   6                                                                                  if(cont1 >= 31){cont1 = 1;}
1619   6                                                                                        else{cont1++;}
1620   6                                                                                }
1621   5                                                                   if(Vert == 2)
1622   5                                                                                 {
1623   6                                                                                   if(cont1 >= 31){ cont1 = 10;}
1624   6                                                                else{cont1++;}
1625   6                                                                                 } 
1626   5                                                                   }
1627   4                                                                 }
1628   3                                                else
1629   3                                                { add_key = 0;}
1630   3                                 //==================================================
1631   3                                             if((set_key & 0x88) == 0x88)       //save
1632   3                                               { 
1633   4                                                      adc_key = 1;
1634   4                                                   }
1635   3                                              else
1636   3                                               { adc_key = 0 ;}
1637   3      //=======================================================================================
1638   3                    if(add_key == 1)
1639   3                     {                                                                                
1640   4                      if(times == 0){if((value_cal%10) == 9){ value_cal = value_cal- 9;}else{value_cal++;}}
1641   4                     else if(times == 1){if((value_cal%100)/10 == 9){ value_cal = value_cal- 90;}else{ value_cal=value
             -_cal+10;}}
1642   4                     else if(times == 2){if((value_cal%1000)/100 == 9){ value_cal = value_cal- 900;}else{  value_cal=va
             -lue_cal+100;}}
1643   4                     else if(times == 3){if((value_cal%10000)/1000 == 9){ value_cal = value_cal- 9000;}else{  value_cal
             -=value_cal+1000;}}
1644   4                     else if(times == 4){if((value_cal%100000)/10000 == 9){value_cal = value_cal- 90000;}else{  value_c
             -al=value_cal+10000;}}
1645   4                         else if(times == 5){if((value_cal/100000) == 9){value_cal = value_cal- 900000;}else{  value_cal=value
             -_cal+100000;}}
1646   4                    }
1647   3      //PS ==============  security code  ==================================
1648   3                                             if(cont1 == 0)
1649   3                                                   { if(sele_key == 1){ times--; if(times >= 6){times = 5;}}
1650   4                                                                 if(Itemm == 1)
1651   4                                                              {  SETUP_LED_Disp(4,value_cal);}
1652   4                                                    else if(Itemm == 2) 
1653   4                                                      { 
1654   5                                                                       if(value_cal == 999999){cont1 = 1; Itemm = 0; Vert = 1; value_cal=0;}      //company  
1655   5                                                          else if(value_cal == 888888){cont1 = 5;  Vert = 2; Itemm = 0;value_cal=0;}  //age 
1656   5                                                              else{ cont1 = 0; Itemm = 0;CAIT=0;}
1657   5                                                                        EEPROM_write_byte(60,Temp_m);
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 28  

1658   5                                                      }
1659   4                                                               }
1660   3      //===========================comprny set up =======================================
1661   3                                          if(((Work_Type == 0)&&((cont1 == 3)||(cont1 == 4)))||((Work_Type == 1)&&((cont1 == 3)||(con
             -t1 == 4)))||((Work_Type == 2)&&((cont1 == 1)||(cont1 == 2)))||((Work_Type == 3)&&((cont1 == 1)||(cont1 == 2))))
1662   3                                                    {  
1663   4                                                          if (Soft_Timer[ADC_READ_TIME] == 0) 
1664   4                                                         {
1665   5                                                               Soft_Timer[ADC_READ_TIME] = 4 ;
1666   5                                                               Data_Value[t_code] = Read_AD3421_Value();
1667   5                                                               if(t_code < 12)
1668   5                                                                    {t_code++;}
1669   5                                                               else
1670   5                                                                {
1671   6                                                                  Data_Value[14] = (Data_Value[12]/5+Data_Value[11]/5+Data_Value[10]/5+Data_Value[9
             -]/5+Data_Value[8]/5);
1672   6                                                                      t_code = 8 ;
1673   6                                                                }
1674   5                                                          }
1675   4                                                                else
1676   4                                                              { Data_Value[14] = Data_Value[t_code] ; }
1677   4                                                       }
1678   3      //==========================   TC_CAL  6===============================
1679   3                                                        if(Work_Type == 0)
1680   3                                                            {
1681   4                                                                  if(cont1 == 1)      // C_F_CAL
1682   4                                                            {
1683   5                                                                           times = 0;
1684   5                                                                   if(value_cal >= 2){value_cal = 0;}
1685   5                                                                         if(Itemm == 1 )
1686   5                                                                       {              
1687   6                                                                                 SETUP_LED_Disp(2, value_cal);
1688   6                                                                           }
1689   5                                                                         else if(Itemm == 2)
1690   5                                                                       { 
1691   6                                                                                 Itemm = 0;
1692   6                                                                         EEPROM_write_byte(C_F_Select,value_cal);  //C,F
1693   6                                                                       }
1694   5                                                                          else
1695   5                                                                           { SETUP_LED_Disp(1,cont1);}
1696   5                                                                }
1697   4      //--------------------------------------- eep 7------------------------------------------------
1698   4                                                                  else if (cont1 == 2)          // TYPE_CAL 7
1699   4                                                                    {
1700   5                                                                             times = 0;
1701   5                                                                     if(value_cal >= 6){value_cal = 0;}
1702   5                                                                         if (Itemm == 1 )
1703   5                                                               {  SETUP_LED_Disp(3,value_cal); }
1704   5                                                                   else if(Itemm == 2)
1705   5                                                                      {       Itemm = 0 ;
1706   6                                                                          EEPROM_write_byte(Type_Select,value_cal);  //K,J,T,E,R,B,S
1707   6                                                                      }
1708   5                                             else { SETUP_LED_Disp(1,cont1);}
1709   5                                                                        }
1710   4      //-------------------------------------eep 8----------------------------------------------------
1711   4                                                                      else if(cont1 == 3)                // TC_ZERO_CAL  
1712   4                                                        { 
1713   5                                                               if(Itemm == 1 )
1714   5                                                                 { SETUP_LED_Disp(6, Data_Value[14]); }
1715   5                                               else if(Itemm == 2)
1716   5                                                                 {  Itemm = 0 ;
1717   6                                                                            Temp_Flag = 3 ;
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 29  

1718   6                                                                            Temp_offset = Temp_m;       //negtive
1719   6                                                                       if (Data_Value[14] >= (Temp_m*13)/10) //-50-tm 
1720   6                                                                                         {
1721   7                                                                                if( AV_COD == 1)
1722   7                                                                                  { Zero_offset =  Data_Value[14] - (Temp_m*13)/10; NG_COD = 1;use_flag = use_fla
             -g|0x01;}
1723   7                                                                               else{ Zero_offset = (Temp_m*13)/10 + Data_Value[14]; NG_COD = 0;use_flag = use_fla
             -g&0xfe;}
1724   7                                                                             }                                                 
1725   6                                                                       else
1726   6                                                                             {  
1727   7                                                                                     if( AV_COD == 1)
1728   7                                                                                  { Zero_offset = (Temp_m*13)/10 - Data_Value[14] ;  NG_COD = 0;use_flag = use_fl
             -ag&0xfe;}
1729   7                                                                                else {Zero_offset = Data_Value[14] + (Temp_m*13)/10 ;  NG_COD = 0;use_flag = use_
             -flag&0xfe;}
1730   7                                                                                  }
1731   6                                                                                  EEPROM_write_byte(Status_flag,(use_flag));
1732   6                                                                                  EEPROM_write_word(Zero,Zero_offset); 
1733   6                                                                      }
1734   5                                                                    else{SETUP_LED_Disp(1,cont1);}    
1735   5                                                 }
1736   4      //--------------------------------------eep 10---12-----------------------------------------
1737   4                                                                       else if(cont1 == 4)//  TC_SPAN_CAL
1738   4                                                 { 
1739   5                                                                       if(Itemm == 1 )
1740   5                                                                         { SETUP_LED_Disp(6,Data_Value[14]); }
1741   5                                                          else if(Itemm == 2)
1742   5                                                                 {  Itemm = 0 ;
1743   6                                                                     if( NG_COD == 1)
1744   6                                                                      {
1745   7                                                                                                 Span_offset = Data_Value[14] + Zero_offset + (Temp_m*13)/10;
1746   7                                                                                               }                                                                                                                 
1747   6                                                                     else
1748   6                                                                                           {
1749   7                                                                                                 Span_offset = Data_Value[14] - Zero_offset + (Temp_m*13)/10;
1750   7                                                                                               }
1751   6                                                                      EEPROM_write_word(Span,Span_offset); 
1752   6                                                                                               
1753   6                                                                      if(Span_offset >= 0xc8ca )
1754   6                                                                        {Span_Value = (Span_offset-Zero_offset)/(Span_offset - 0xc8ca);use_flag = u
             -se_flag|0x10;}
1755   6                                                                      else
1756   6                                                                        {Span_Value = (Span_offset-Zero_offset)/(0xc8ca - Span_offset);use_flag = u
             -se_flag&0xef;}
1757   6                                                                        EEPROM_write_word(Slope,Span_Value);
1758   6                                                                            delay(50);
1759   6                                                                            EEPROM_write_byte(Status_flag,use_flag);
1760   6                                                                  }
1761   5                                                                         else
1762   5                                                                         { SETUP_LED_Disp(1,cont1);}
1763   5                                                          }
1764   4                                                                       }
1765   3      //======================================eep 6===========   Rtd_CAL  =========================
1766   3                                                                 else if(Work_Type == 1)
1767   3                                                                {
1768   4                                                                      if(cont1 == 1)  // C_F_CAL
1769   4                                                                {
1770   5                                                                              times = 0;
1771   5                                                                      if(value_cal >= 1){value_cal = 0;}
1772   5                                                                          if(Itemm == 1 )
1773   5                                                                       {              
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 30  

1774   6                                                                                 SETUP_LED_Disp(1,value_cal);
1775   6                                                                           }
1776   5                                                                         else if(Itemm == 2)
1777   5                                                                       { 
1778   6                                                                                 Itemm = 0;
1779   6                                                                         EEPROM_write_byte(C_F_Select,value_cal);  //C,F
1780   6                                                                       }
1781   5                                                                          else
1782   5                                                                           { SETUP_LED_Disp(1,cont1);}
1783   5                                                                }
1784   4      //-------------------------------------eep 7-----------------------
1785   4                                                                else if (cont1 == 2)    // TYPE_CAL
1786   4                                                                    {
1787   5                                                                             times = 0;
1788   5                                                                     value_cal = 0x07;
1789   5                                                                     if (Itemm == 1 )
1790   5                                                               {  SETUP_LED_Disp(2,value_cal); }
1791   5                                                                   else if(Itemm == 2)
1792   5                                                                      {       Itemm = 0 ;
1793   6                                                                          EEPROM_write_byte(Type_Select,value_cal);  //rtd
1794   6                                                                      }
1795   5                                             else { SETUP_LED_Disp(1,cont1);}
1796   5                                                                        }
1797   4      //------------------------------------eep 8------------------------------------
1798   4                                                                 else if(cont1 == 3)  // RTD_ZERO_CAL
1799   4                                                {  times = 0;
1800   5                                                                   if(Itemm == 1 )
1801   5                                                                         {
1802   6                                                                       if( AV_COD == 1){ NG_COD = 1;}else{ NG_COD = 0;}
1803   6                                                                           SETUP_LED_Disp(6,Data_Value[14]);
1804   6                                                                         }
1805   5                                                                    else if(Itemm == 2)
1806   5                                                                     { Itemm = 0;
1807   6                                                                       Zero_offset = Data_Value[14] ;
1808   6                                                                       EEPROM_write_word(Zero,Zero_offset);  //rtd
1809   6                                                                          delay(50);
1810   6                                                                        if( NG_COD == 1){ EEPROM_write_byte(Status_flag,(use_flag|0x02));}
1811   6                                                                        else { EEPROM_write_byte(Status_flag,(use_flag&0xfd));}
1812   6                                                                     }
1813   5                                                                        else
1814   5                                                                         { SETUP_LED_Disp(1,cont1);}
1815   5                                                              }
1816   4      //-----------------------------------eep 10 ---12--------------------------------------------------------
1817   4                                                               else if(cont1 == 4)    //   RTD_SPAN_CA
1818   4                                              {  
1819   5                                                                          times = 0;
1820   5                                                                  if(Itemm == 1 )
1821   5                                                                       { SETUP_LED_Disp(6,Data_Value[14]);  }
1822   5                                                                else if(Itemm == 2)
1823   5                                                               { Itemm = 0;
1824   6                                                                          Span_offset = Data_Value[14] ;
1825   6                                                                          EEPROM_write_word(Span,Span_offset);  //rtd
1826   6                                                                          if( NG_COD == 1)
1827   6                                                                            { if ((Span_offset + Zero_offset) > 0x44e4 )
1828   7                                                                                 { Span_Value = ((Span_offset + Zero_offset)/((Span_offset + Zero_offset)-0x44e4)
             -);}
1829   7                                                                                      else
1830   7                                                                                         { Span_Value = ((Span_offset + Zero_offset)/(0x44e4 - (Span_offset + Zero_offset)));}
1831   7                                                                                 }
1832   6                                                                              else
1833   6                                                                                { if ((Span_offset - Zero_offset) > 0x44e4 )
1834   7                                                                                     {Span_Value = ((Span_offset - Zero_offset)/((Span_offset - Zero_offset)-0x44e4));}
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 31  

1835   7                                                                                  else
1836   7                                                                                     {Span_Value = ((Span_offset - Zero_offset)/(0x44e4 - (Span_offset - Zero_offset)));
             -}
1837   7                                                                                }
1838   6                                                                                 EEPROM_write_word(Slope,Span_Value);
1839   6                                                                       }                                                      
1840   5                                                                     else
1841   5                                                                          { SETUP_LED_Disp(1,cont1);}
1842   5                                                               }
1843   4                                                         }
1844   3      //==============================   mV_ZERO_CAL  ===eep 8==================================================
             -======
1845   3                                                       else if(Work_Type == 2)
1846   3                                                          {
1847   4                                               if(cont1 == 1)
1848   4                                             {        
1849   5                                                                  if(Itemm == 1 )
1850   5                                                                    {
1851   6                                                      if( AV_COD == 1){ NG_COD = 1;}else{ NG_COD = 0;}
1852   6                                                                   SETUP_LED_Disp(6,Data_Value[14]);
1853   6                                                                    }
1854   5                                                             else if(Itemm == 2)
1855   5                                                                { Itemm = 0 ;
1856   6                                                                       Zero_offset = Data_Value[14] ;
1857   6                                                                       EEPROM_write_word(Zero,Zero_offset);  
1858   6                                                                       delay(50);
1859   6                                                                        if( NG_COD == 1){ EEPROM_write_byte(Status_flag,(use_flag|0x04));}
1860   6                                                                       else { EEPROM_write_byte(Status_flag,(use_flag&0xfb));}
1861   6                                                                }
1862   5                                                               else
1863   5                                                                { SETUP_LED_Disp(1,cont1);}
1864   5                                                        }
1865   4      //-----------------------------------------------eep 10 -12------
1866   4                                            else if(cont1 == 2)          //  mV_SPAN_CAL
1867   4                                            {
1868   5                                                                  if(Itemm == 1 )
1869   5                                                            {   SETUP_LED_Disp(6,Data_Value[14]); }
1870   5                                                          else if(Itemm == 2)
1871   5                                                            { Itemm = 0;      cont1 = 4 ;
1872   6                                                                   Span_offset = Data_Value[14] ;
1873   6                                                                   EEPROM_write_word(Span,Span_offset);  
1874   6                                                                  if( NG_COD == 1)
1875   6                                                                    { if ((Span_offset + Zero_offset) > 0x7d00 )               
1876   7                                                                        { Span_Value = ((Span_offset + Zero_offset)/((Span_offset + Zero_offset)-0x7d00));
             -}
1877   7                                                                      else
1878   7                                                                        { Span_Value = ((Span_offset + Zero_offset)/(0x7d00 - (Span_offset + Zero_offset))
             -);}
1879   7                                                                    }
1880   6                                                              else
1881   6                                                                {  if((Span_offset - Zero_offset) > 0x7d00)
1882   7                                                                             {Span_Value = ((Span_offset - Zero_offset)/((Span_offset - Zero_offset)-0x7d00));}
1883   7                                                                       else
1884   7                                                                         {Span_Value = ((Span_offset - Zero_offset)/(0x7d00 - (Span_offset - Zero_offset))
             -);}
1885   7                                                                    }
1886   6                                                                         EEPROM_write_word(Slope,Span_Value);
1887   6                                                       }
1888   5                                                          else
1889   5                                                          { SETUP_LED_Disp(1,cont1);}
1890   5                                                    }
1891   4                                                       }
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 32  

1892   3      //===============================        mA_ZERO_CAL  ==eep 8 ====================================
1893   3                            else if(Work_Type == 3)
1894   3                                           {
1895   4                                                           if(cont1 == 1)
1896   4                                             {                                                                                                                                                                    
1897   5                                                            if(Itemm == 1 )
1898   5                                                              {  if( AV_COD == 1){ NG_COD = 1;}else{ NG_COD = 0;}
1899   6                                                                          SETUP_LED_Disp(6,Data_Value[14]);
1900   6                                                                  }
1901   5                                                           else if(Itemm == 2)
1902   5                                                                  { Itemm = 0; 
1903   6                                                                    Zero_offset = Data_Value[14];
1904   6                                                                    EEPROM_write_word(Zero,Zero_offset);  
1905   6                                                                    delay(50);
1906   6                                                                        if( NG_COD == 1){ EEPROM_write_byte(Status_flag,(use_flag|0x08));}
1907   6                                                                    else { EEPROM_write_byte(Status_flag,(use_flag&0xf7));}
1908   6                                                                  }
1909   5                                                             else
1910   5                                                              { SETUP_LED_Disp(1,cont1);}
1911   5                                                         }
1912   4      //--------------------------------------eep 10   12 ------------
1913   4                                             else if(cont1 == 2)       // mA_SPAN_CAL 
1914   4                                           {  
1915   5                                                          if(Itemm == 1 )
1916   5                                                            {  SETUP_LED_Disp(6,Data_Value[14]);}
1917   5                                                              else if(Itemm == 2)
1918   5                                                                {     Itemm = 0; cont1 = 4;
1919   6                                                                  Span_offset = Data_Value[14]; 
1920   6                                                                      EEPROM_write_word(Span,Span_offset);  
1921   6                                                                      if( NG_COD == 1)
1922   6                                                                        {  if ((Span_offset + Zero_offset) > 0x1900 ) 
1923   7                                                                              { Span_Value = ((Span_offset + Zero_offset)/((Span_offset + Zero_offset)- 0x1900));
             -}
1924   7                                                                               else
1925   7                                                                                 { Span_Value = ((Span_offset + Zero_offset)/( 0x1900 - (Span_offset + Zero_offset)));}
1926   7                                                                         }
1927   6                                                                   else
1928   6                                                                         {  if ((Span_offset - Zero_offset) > 0x1900 )
1929   7                                                                               {Span_Value = ((Span_offset - Zero_offset)/((Span_offset - Zero_offset)- 0x1900));
             -}
1930   7                                                                                else
1931   7                                                                                   {Span_Value = ((Span_offset - Zero_offset)/( 0x1900 - (Span_offset - Zero_offset)));}
1932   7                                                                         }
1933   6                                                                            EEPROM_write_word(Slope,Span_Value);
1934   6                                                                 }
1935   5                                                                else
1936   5                                                             { SETUP_LED_Disp(1,cont1);}
1937   5                                                    }
1938   4                                                       }
1939   3      //-------------------- YEAR_DATE_CAL ------eep14-------------------
1940   3                                        if(cont1 == 5)
1941   3                                       {      if(sele_key == 1){times--; if(times >= 2){times = 1;}}
1942   4                                                  if(Itemm == 1 )
1943   4                                                         {
1944   5                                                                  if(value_cal <= 99)
1945   5                                                                        {                                                             
1946   6                                             use_year = value_cal; 
1947   6                                                                        }
1948   5                                                                       else{value_cal = 0;}
1949   5                                                            SETUP_LED_Disp(6,use_year + 2000);
1950   5                                                            }
1951   4                                                  else if(Itemm == 2)
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 33  

1952   4                                                        { Itemm = 0;
1953   5                                                              RTC_write_byte(6,use_year);
1954   5                                                              EEPROM_write_byte(Year_Date,use_year); 
1955   5                                                        }
1956   4                                                      else
1957   4                                                        { SETUP_LED_Disp(1,cont1);}
1958   4                                             }
1959   3      //------------------------MON_DATE_CAL ------eep 15---------
1960   3                                       else if(cont1 == 6)
1961   3                                {        times = 0;
1962   4                                          if(Itemm == 1 )
1963   4                                            {  
1964   5                                                  if(value_cal >= 1) {use_mon++ ; value_cal = 0;}
1965   5                                                  if((use_mon > 12)||(use_mon == 0)) {use_mon = 1;}
1966   5                                              SETUP_LED_Disp(6,use_mon);
1967   5                                                }
1968   4                                          else if(Itemm == 2)
1969   4                                            { 
1970   5                                                  Itemm = 0;
1971   5                                                  RTC_write_byte(5,use_mon);
1972   5                                                  EEPROM_write_byte(Mon_Date,use_mon);
1973   5                                           }
1974   4                                         else
1975   4                                               { SETUP_LED_Disp(1,cont1);}
1976   4                                      }
1977   3      //------------------------ DAY_DATE_CAL ----16-------   //add week setup
1978   3                                 else if(cont1 == 7)
1979   3                               {       times = 0;
1980   4                                          if(Itemm == 1 )
1981   4                                            {         if(value_cal >= 1){use_day++; value_cal = 0 ;}
1982   5                                                               if((use_mon == 2)&&(use_year%4 == 0)&&(use_day > 29)) { use_day = 1; value_cal = 0;}
1983   5                                                              else if((use_mon == 2)&&(use_year%4 != 0)&&(use_day > 28)){ use_day = 1; value_cal = 0;}
1984   5                                                               if(((use_mon == 1)||(use_mon == 3)||(use_mon == 5)||(use_mon == 7)||(use_mon == 8)||(use_mon == 10
             -)||(use_mon == 12))&&(use_day > 31)) { use_day = 1;value_cal = 0;}
1985   5                                                              else if(((use_mon == 4)||(use_mon == 6)||(use_mon == 9)||(use_mon == 0x11))&&(use_day > 30)) { use_
             -day = 1; value_cal = 0;}
1986   5               
1987   5                                                           SETUP_LED_Disp(6,use_day);
1988   5                                                }
1989   4                                               else if(Itemm == 2)
1990   4                                                {  Itemm = 0;                                           
1991   5                                                       RTC_write_byte(4,use_day);
1992   5                                                       EEPROM_write_byte(Day_Date,use_day);
1993   5                                                }
1994   4                                               else
1995   4                                               { SETUP_LED_Disp(1,cont1);}
1996   4                                }
1997   3      //-------------------- HOUR_DATE_CAL  ------17-----------------
1998   3                                   else if(cont1 == 8)
1999   3                                {       times = 0;
2000   4                                            if(Itemm == 1 )
2001   4                                                  {
2002   5                                                         if(value_cal >= 1){use_hour++; value_cal = 0 ;}
2003   5                                                         if(use_hour > 23) {use_hour = 0; value_cal = 0;}
2004   5                                                         SETUP_LED_Disp(6,use_hour);
2005   5                                                      }
2006   4                                                else if(Itemm == 2)
2007   4                                                        {  Itemm = 0;
2008   5                                                               RTC_write_byte(2,use_hour);
2009   5                                                               EEPROM_write_byte(Hour_Date,use_hour);
2010   5                                                        }
2011   4                                                      else
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 34  

2012   4                                                    { SETUP_LED_Disp(1,cont1);}
2013   4                                         }
2014   3      //------------------  MIN_DATE_CAL  -------18------------
2015   3                                       else if(cont1 == 9)
2016   3                                 { times = 0;
2017   4                                            if(Itemm == 1 )
2018   4                                                       {
2019   5                                                        if(value_cal >= 1){use_min++; value_cal = 0 ;}        
2020   5                                                        if(use_min > 59) {use_min = 0; value_cal = 0;}
2021   5                                              SETUP_LED_Disp(6,use_min );
2022   5                                                 }
2023   4                                         else if(Itemm == 2)
2024   4                                                { Itemm = 0;
2025   5                                                      RTC_write_byte(1,use_min );
2026   5                                                      EEPROM_write_byte(Min_Date,use_min);
2027   5                                                }
2028   4                                              else
2029   4                                                { SETUP_LED_Disp(1,cont1);}
2030   4                                         }
2031   3      //===================================eep20=============================
2032   3      /*********************  ]w  HS **********************/
2033   3                                   else if(cont1 == 10)
2034   3                                 {  if(sele_key == 1){times--; if(times >= 5){times = 4;}}
2035   4                                                if(Itemm == 1 )
2036   4                                                  {  
2037   5                                                         if(value_cal > 65535){value_cal = 0;}     //  Disp_Show = 1 ;
2038   5                                                 SETUP_LED_Disp(6,value_cal);
2039   5                                                  }
2040   4                                            else if(Itemm == 2)
2041   4                                                  {
2042   5                                                          Itemm = 0;
2043   5                                                              EEPROM_write_word(Hi_Disp,value_cal);
2044   5                                                              Flag_Read = 0;
2045   5                                                          value_cal = 0;
2046   5                                                  }
2047   4                                                else
2048   4                                                  { SETUP_LED_Disp(1,cont1);
2049   5                                                         if(Flag_Read == 0){value_cal = EEPROM_read_word(Hi_Disp);Flag_Read = 1;}
2050   5                                                      }
2051   4                                         }
2052   3      //---------------------   ]wC  LS -eep 22------------------------
2053   3                                    else if(cont1 == 11)
2054   3                                 {   if(sele_key == 1){ times--; if(times >= 5){times = 4;}}
2055   4                                                 if(Itemm == 1 )
2056   4                                                   { 
2057   5                                                        if(value_cal > 65535){value_cal = 0;}
2058   5                                                        SETUP_LED_Disp(6,value_cal);
2059   5                                                       }
2060   4                                             else if(Itemm == 2)
2061   4                                                   { 
2062   5                                                          Itemm = 0;
2063   5                                                          EEPROM_write_word(Lo_Disp,value_cal);
2064   5                                                          Flag_Read = 0;
2065   5                                                          value_cal = 0;
2066   5                                                   }
2067   4                                                 else
2068   4                                                  { SETUP_LED_Disp(1,cont1);
2069   5                                                        if(Flag_Read == 0){value_cal = EEPROM_read_word(Lo_Disp);Flag_Read = 1;}
2070   5                                                      }
2071   4                                         }
2072   3      //---------------------    ]wJ  RH ---24----------------------
2073   3                                     else if(cont1 ==12)
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 35  

2074   3                                  {  if(sele_key == 1){times--; if(times >= 5){times = 4;}}
2075   4                                                if(Itemm == 1 )
2076   4                                                  {  
2077   5                                                         if(value_cal > 65535){value_cal = 0;}
2078   5                                                         SETUP_LED_Disp(6,value_cal);
2079   5                                                  }
2080   4                                            else if(Itemm == 2)
2081   4                                                  {
2082   5                                                        Itemm = 0;
2083   5                                                        EEPROM_write_word(Hi_Input,value_cal);
2084   5                                                        Flag_Read = 0;
2085   5                                                        value_cal = 0;
2086   5                                                  }
2087   4                                                else
2088   4                                                  { SETUP_LED_Disp(1,cont1);
2089   5                                                        if(Flag_Read == 0){value_cal = EEPROM_read_word(Hi_Input);Flag_Read = 1;}
2090   5                                                      }
2091   4                                              }
2092   3      //---------------------    ]wCJ  RL ---26----------------------
2093   3                                     else if(cont1 == 13)
2094   3                                  {  if(sele_key == 1){times--; if(times >= 5){times = 4;}}
2095   4                                                if(Itemm == 1 )
2096   4                                                  {   
2097   5                                                         if(value_cal > 65535){value_cal = 0;}
2098   5                                                         SETUP_LED_Disp(6,value_cal);
2099   5                                                      }
2100   4                                            else if(Itemm == 2)
2101   4                                                  {
2102   5                                                        Itemm = 0;
2103   5                                                        EEPROM_write_word(Lo_Input,value_cal);
2104   5                                                       
2105   5                                                  }
2106   4                                                else
2107   4                                                  { SETUP_LED_Disp(1,cont1);
2108   5                                                        if(Flag_Read == 0){value_cal = EEPROM_read_word(Lo_Input);Flag_Read = 1;}
2109   5                                                      }
2110   4                                              }
2111   3      //---------------------   RELAY HI I HI ---28 ----------------------
2112   3                                     else if(cont1 == 14)
2113   3                                  { if(sele_key == 1){times--; if(times >= 5){times = 4;}}
2114   4                                                if(Itemm == 1 )
2115   4                                                {
2116   5                                                       if     (value_cal > 65535){value_cal = 0;}
2117   5                                                      SETUP_LED_Disp(6,value_cal);
2118   5      
2119   5                                                }
2120   4                                              else if(Itemm == 2)
2121   4                                                {     Itemm = 0;
2122   5                                                   EEPROM_write_word(Alarm_Hi,value_cal);  //alarm
2123   5                                                }
2124   4                                              else
2125   4                                                { SETUP_LED_Disp(1,cont1);}
2126   4                                       }
2127   3      //---------------------   RELAY HH I HH ----30---------------------
2128   3                                  else if(cont1 == 15)
2129   3                               {  if(sele_key == 1){ times--; if(times >= 5){times = 4;}}
2130   4                                               if(Itemm == 1 )
2131   4                                            {   
2132   5                                                   if (value_cal > 65535){value_cal = 0;}
2133   5                                                       SETUP_LED_Disp(6,value_cal);
2134   5                                                }
2135   4                                         else if(Itemm == 2)
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 36  

2136   4                                                {     Itemm = 0;
2137   5                                                   EEPROM_write_word(Relay_HH,value_cal);  //alarm
2138   5                                                }
2139   4                                               else
2140   4                                                { SETUP_LED_Disp(1,cont1);}
2141   4                                       }
2142   3      //---------------------   RELAY LL I LL ---32----------------------
2143   3                                 else if(cont1 == 16)
2144   3                                      {  if(sele_key == 1){ times--; if(times >= 5){times = 4;}}
2145   4                                                if(Itemm == 1 )
2146   4                                                 { 
2147   5                                                   if (value_cal > 65535){value_cal = 0;}
2148   5                                                        SETUP_LED_Disp(6,value_cal);
2149   5                                                 }
2150   4                                          else if(Itemm == 2)
2151   4                                            { Itemm = 0;
2152   5                                               EEPROM_write_word(Relay_LL,value_cal);  //alarm
2153   5                                                }
2154   4                                          else
2155   4                                            { SETUP_LED_Disp(1,cont1);}        
2156   4                                        }
2157   3      //---------------------    RELAY LO I LO---34----------------------
2158   3                                  else if(cont1 == 17)
2159   3                                {      if(sele_key == 1){ times--; if(times >= 5){times = 4;}}
2160   4      
2161   4                                                if(Itemm == 1 )
2162   4                                                  { 
2163   5                                                          if  (value_cal > 65535){value_cal = 0;}
2164   5                                                          SETUP_LED_Disp(6,value_cal);
2165   5                                              }
2166   4                                         else if(Itemm == 2)
2167   4                                                 {  Itemm = 0;
2168   5                                                    EEPROM_write_word(Alarm_Low,value_cal);  //alarm
2169   5                                                 }
2170   4                                               else
2171   4                                                { SETUP_LED_Disp(1,cont1);} 
2172   4                                   }
2173   3      //---------------------   pIm  D0 0=L 1= 2=B 3=...(L) --36----------------
             --------
2174   3                                else if(cont1 == 18)
2175   3                                      {       times = 0;
2176   4                                             if(Itemm == 1 )
2177   4                                                { 
2178   5                                          if(value_cal >= 5){ value_cal = 0;}
2179   5                                                       SETUP_LED_Disp(6,value_cal);
2180   5                                                 }                                            
2181   4                                         else if(Itemm == 2)
2182   4                                                {
2183   5                                                  Itemm = 0;
2184   5                                                  EEPROM_write_byte(Dot_Point,value_cal);  //alarm
2185   5                                                }
2186   4                                              else
2187   4                                                  { SETUP_LED_Disp(1,cont1);}
2188   4                                              }
2189   3      //---------------------   s]w DT  0 ~ 9S -----37--------------------
2190   3                                     else if(cont1 == 19)
2191   3                                  {   times = 0;
2192   4                                            if(Itemm == 1 )
2193   4                                                  { 
2194   5                                            if(value_cal > 9){ value_cal = 0;}
2195   5                                                       SETUP_LED_Disp(6,value_cal);
2196   5                                                  }
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 37  

2197   4                                            else if(Itemm == 2)
2198   4                                                  {  Itemm = 0;
2199   5                                                         EEPROM_write_byte(Flash_Disp,value_cal);  //alarm
2200   5                                                  }                                                           
2201   4      
2202   4                                                else
2203   4                                                 { SETUP_LED_Disp(1,cont1);}
2204   4                                              }
2205   3      //---------------------    s ]w  OF  +XXX ~ - XXX ---38----------------------
2206   3                                     else if(cont1 == 20)
2207   3                                  { if(sele_key == 1){times--; if(times >= 5){times = 4;}}
2208   4                                                if(Itemm == 1 )
2209   4                                                  {
2210   5                                                       if     (value_cal > 65535){value_cal = 0;}
2211   5                                                       SETUP_LED_Disp(6,value_cal);
2212   5                              }
2213   4                                            else if(Itemm == 2)
2214   4                                                  {  Itemm = 0;
2215   5                                                     EEPROM_write_word(Zero_Code,value_cal);  //alarm
2216   5                                                      }
2217   4                                                else
2218   4                                                  { SETUP_LED_Disp(1,cont1);}
2219   4                                              }
2220   3      //---------------------   SAMPLE RATE SET BU  0 ~4, 1200/2400/4800/9600/19200----40---------------------
2221   3                                     else if(cont1 == 21)
2222   3                                  {  times = 0;
2223   4                                                if(Itemm == 1 )
2224   4                                                  {    if(value_cal >= 5){ value_cal = 0;}    
2225   5                                                               if(value_cal == 0){ Show_Data = 1200;} 
2226   5                                                               if(value_cal == 1){ Show_Data = 2400;} 
2227   5                                                               if(value_cal == 2){ Show_Data = 4800;} 
2228   5                                                               if(value_cal == 3){ Show_Data = 9600;}
2229   5                                                               if(value_cal == 4){ Show_Data = 19200;}                                                                        
2230   5                                            
2231   5                                                       SETUP_LED_Disp(6,Show_Data);
2232   5                                                 }
2233   4                                            else if(Itemm == 2)
2234   4                                                  {Itemm = 0;
2235   5                                                     EEPROM_write_byte(Sample_Rate,value_cal);  //alarm
2236   5                                                  }
2237   4                                                else
2238   4                                                  { SETUP_LED_Disp(1,cont1);}
2239   4                                              }
2240   3      //---------------------    ID CODE ID   0 ~99 ----------------41---------
2241   3                                     else if(cont1 == 22)
2242   3                                  { if(sele_key == 1){times--; if(times >= 2){times = 1;}}
2243   4                                                if(Itemm == 1 )
2244   4                                                  {
2245   5                                                        if(value_cal > 99){value_cal = 0;}
2246   5                                                   SETUP_LED_Disp(6,value_cal);
2247   5                                                  }
2248   4                                            else if(Itemm == 2)
2249   4                                                  {Itemm = 0;
2250   5                                                       EEPROM_write_byte(ID_Code,value_cal);  //alarm
2251   5                                                  }
2252   4                                                else
2253   4                                                  { SETUP_LED_Disp(1,cont1);}
2254   4                                              }
2255   3      //---------------------    CIB  LD --------------42-----------
2256   3                                     else if(cont1 == 23)
2257   3                                  {   if(sele_key == 1){times--; if(times >= 5){times = 4;}}
2258   4                                                if(Itemm == 1 )
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 38  

2259   4                                                   {if (value_cal > 65535){value_cal = 0;}
2260   5                                                      SETUP_LED_Disp(6,value_cal);
2261   5                                                   }
2262   4                                            else if(Itemm == 2)
2263   4                                                  {Itemm = 0;
2264   5                                                    EEPROM_write_word(Lo_Mask,value_cal); }
2265   4                                                else
2266   4                                                  { SETUP_LED_Disp(1,cont1);}
2267   4                                              }
2268   3      //---------------------    i]w  CD   0 ~ 9 ------------44-------------
2269   3                                     else if(cont1 == 24)
2270   3                                  {   times = 0 ;
2271   4                                                if(Itemm == 1 )
2272   4                                                      {
2273   5                                                        if(value_cal > 9){value_cal = 0;}
2274   5                                                       SETUP_LED_Disp(6,value_cal);
2275   5                                          }
2276   4                                            else if(Itemm == 2)
2277   4                                                  {Itemm = 0; EEPROM_write_byte(Count_Code,value_cal); 
2278   5                                                  }
2279   4                                                else
2280   4                                                  { SETUP_LED_Disp(1,cont1);}
2281   4                                              }
2282   3      //---------------------   ]w  DB  00,01= 1   02= 2 03=3 ------45-------------------
2283   3                                     else if(cont1 == 25)
2284   3                                  {           times = 0 ;
2285   4                                                if(Itemm == 1 )
2286   4                                                  {
2287   5                                                        if(value_cal > 9){ value_cal = 0;}                                                                            
2288   5                                                          SETUP_LED_Disp(6,value_cal);
2289   5                                              }
2290   4                                            else if(Itemm == 2)
2291   4                                                  {Itemm = 0; EEPROM_write_byte(Gain,value_cal); 
2292   5                                                  }
2293   4                                                else
2294   4                                                 { SETUP_LED_Disp(1,cont1);}
2295   4                                              }
2296   3      //---------------------  D]w  MS  00 = D(e), 01=(e), 02=DDe,03=D
             -e ----46---------------------
2297   3                                     else if(cont1 == 26)
2298   3                                  {   times = 0 ;
2299   4                                                if(Itemm == 1 )
2300   4                                                  { 
2301   5                                                        if(value_cal > 3){ value_cal = 0;}                                                                            
2302   5                                        
2303   5                                                         SETUP_LED_Disp(6,value_cal);
2304   5                                                 }
2305   4                                            else if(Itemm == 2)
2306   4                                                  {Itemm = 0; EEPROM_write_byte(Transfor,value_cal); 
2307   5                                                  }
2308   4                                               else
2309   4                                                { SETUP_LED_Disp(1,cont1);}
2310   4                                              }
2311   3      //---------------------    ]w  HD   5, ----------48---------------
2312   3                                     else if(cont1 == 27)
2313   3                                  {    if(sele_key == 1){ times--; if(times >= 5){times = 4;}}
2314   4                                                if(Itemm == 1 )
2315   4                                                  {   if(value_cal > 65535){value_cal = 0;}
2316   5                                                         SETUP_LED_Disp(6,value_cal);
2317   5                                                }
2318   4                                            else if(Itemm == 2)
2319   4                                                  {Itemm = 0;  EEPROM_write_word(Disp_Hi,value_cal); 
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 39  

2320   5                                                  }
2321   4                                                else
2322   4                                                  { SETUP_LED_Disp(1,cont1);}
2323   4                                              }
2324   3      //---------------------   RELAY   RS 1 = ON , 0 = OFF, --------------50-----------
2325   3                                     else if(cont1 == 28)
2326   3                                  { times = 0 ;
2327   4                                                if(Itemm == 1 )
2328   4                                                  {                                                   
2329   5                                                  if(value_cal >= 2){ value_cal = 0;}
2330   5                                                              SETUP_LED_Disp(6,value_cal);
2331   5                                                 }
2332   4                                            else if(Itemm == 2)
2333   4                                                  {Itemm = 0;
2334   5                                                        EEPROM_write_byte(Relay,value_cal);  
2335   5                                                  }
2336   4                                                else
2337   4                                                 { SETUP_LED_Disp(1,cont1);}
2338   4                                              }
2339   3      //---------------------   ]w DS  2 ~ 5 -----------------51--------
2340   3                                     else if(cont1 == 29)
2341   3                                  {  times = 0 ;
2342   4                                                if(Itemm == 1 )
2343   4                                                  { 
2344   5                                                           if(value_cal < 2){value_cal = 2;}
2345   5                                                               if(value_cal >= 6){value_cal = 2;}
2346   5                                                      SETUP_LED_Disp(6,value_cal);                                                                            
2347   5                                                 }
2348   4                                            else if(Itemm == 2)
2349   4                                                  {Itemm = 0;EEPROM_write_byte(Disp_Count,value_cal);
2350   5                                                  }
2351   4                                                else
2352   4                                                 { SETUP_LED_Disp(1,cont1);}
2353   4                                              }
2354   3      //---------------------   e]w CL   0 = , 1=n(U 0.0~0.9) ----------52-----------
             -----
2355   3                                     else if(cont1 == 30)                                             
2356   3                                          {  times = 0 ;
2357   4                                                if(Itemm == 1 )
2358   4                                                  { 
2359   5                                              
2360   5                                                {                                                                             
2361   6                                                  if(value_cal >= 2){ value_cal = 0;}
2362   6                                                        }
2363   5                                                    SETUP_LED_Disp(6,value_cal);
2364   5                                               }
2365   4                                             else if(Itemm == 2)
2366   4                                                   {Itemm = 0;EEPROM_write_byte(Zero_Set,value_cal);
2367   5                                                   }
2368   4                                                else
2369   4                                                  { SETUP_LED_Disp(1,cont1);}
2370   4                                              }
2371   3      //---------------------   JC  RT  12/14/16 bit) -----------------53--------
2372   3                                     else if(cont1 == 31)
2373   3                                  {  times = 0 ;
2374   4                                                if(Itemm == 1 )
2375   4                                                  { 
2376   5                                                          if(value_cal >= 3){ value_cal = 0;}
2377   5                                              if(value_cal == 0){ Show_Data = 12;}
2378   5                                                              if(value_cal == 1){ Show_Data = 14;}
2379   5                                                              if(value_cal == 2){ Show_Data = 16;}
2380   5                                                      //      if(value_cal == 3){ Show_Data = 18;}
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 40  

2381   5                                                          SETUP_LED_Disp(6,Show_Data);
2382   5                                                      }
2383   4                                            else if(Itemm == 2)                                        
2384   4                                                  { Itemm = 0;
2385   5                                                        EEPROM_write_byte(Decode_Num,value_cal);
2386   5                                                  }
2387   4                                                else
2388   4                                                  { SETUP_LED_Disp(1,cont1);}
2389   4                                             }
2390   3                                        }
2391   2                             }
2392   1                      Check_PCB();                    
2393   1      }
2394          //*******************************
2395          void RTC_ON(void)
2396          { 
2397   1         use_week = RTC_read_byte(0x03);
2398   1         RTC_write_byte(0x07,SQWE);
2399   1         RTC_write_byte(0x03,use_week|0x08);    
2400   1                                   
2401   1          if((use_week&OSC_EN) == OSC_EN) {;}       // if oscillator = already running, do nothing. 
2402   1          else
2403   1               { 
2404   2             RTC_write_byte(0x06,use_year)   ;     // initialize YEAR  register           
2405   2             RTC_write_byte(0x05,use_mon)    ;     // initialize MONTH register  
2406   2             RTC_write_byte(0x04,use_day)    ;     // initialize DATE  register  
2407   2             RTC_write_byte(0x03,use_week|0x08);
2408   2             RTC_write_byte(0x02,use_hour)   ;     // initialize HOUR  register  
2409   2             RTC_write_byte(0x01,use_min)    ;     // initialize MIN   register  
2410   2               } 
2411   1       
2412   1      }
2413          /************************************************/
2414          void RTC_WRITE_SET(void)
2415          {
2416   1      
2417   1         RTC_write_byte(0x00,(use_sec|0x80));
2418   1      
2419   1         RTC_write_byte(0x01,use_min);
2420   1      
2421   1         RTC_write_byte(0x02,use_hour);
2422   1      
2423   1         RTC_write_byte(0x03,use_week|0x08);
2424   1      
2425   1         RTC_write_byte(0x04,use_day);
2426   1      
2427   1         RTC_write_byte(0x05,use_mon);
2428   1      
2429   1         RTC_write_byte(0x06,use_year);
2430   1      
2431   1         RTC_write_byte(0x07,0x40);
2432   1      }
2433          /*****************************************/
2434          void RTC_READ_SET(void)
2435          { 
2436   1       use_sec  = RTC_read_byte(0x00)&0x7f ;
2437   1       use_min  = RTC_read_byte(0x01) ;
2438   1       use_hour = RTC_read_byte(0x02) ;
2439   1       use_week = RTC_read_byte(0x03)&0x07 ;
2440   1       use_day  = RTC_read_byte(0x04);
2441   1       use_mon  = RTC_read_byte(0x05);
2442   1       use_year = RTC_read_byte(0x06);
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 41  

2443   1      
2444   1       if((use_mon&0x03) == 0x01)
2445   1       { 
2446   2         EEPROM_write_byte(Year_Date,use_year);
2447   2         EEPROM_write_byte(Mon_Date, use_mon);
2448   2         EEPROM_write_byte(Day_Date, use_day);
2449   2         EEPROM_write_byte(Hour_Date,use_hour);
2450   2         EEPROM_write_byte(Min_Date, use_min);
2451   2       }
2452   1      }
2453          /******************************************
2454            EEP_Default Value
2455          ******************************************/
2456          void EEPROM_WriteDefault(void)
2457          {
2458   1          EEPROM_write_byte(C_F_Select, 0);   //c
2459   1              EEPROM_write_byte(Type_Select,0);   //Type define k=0.j=1,t=2
2460   1              EEPROM_write_word(Zero, 0);                     //
2461   1              EEPROM_write_word(Span, 50000);
2462   1              EEPROM_write_word(Slope, 1);
2463   1          EEPROM_write_byte(Year_Date,0x15);
2464   1          EEPROM_write_byte(Mon_Date, 0x01);
2465   1          EEPROM_write_byte(Day_Date, 0x01);
2466   1          EEPROM_write_byte(Hour_Date,0x12);
2467   1          EEPROM_write_byte(Min_Date, 0x01);
2468   1      
2469   1          EEPROM_write_word(Hi_Disp, 65535);
2470   1          EEPROM_write_word(Lo_Disp, 0);
2471   1          EEPROM_write_word(Hi_Input, 65535);
2472   1          EEPROM_write_word(Lo_Input, 0);
2473   1              EEPROM_write_word(Alarm_Hi, 5000);
2474   1              EEPROM_write_word(Relay_HH, 5000);
2475   1              EEPROM_write_word(Relay_LL,  0);
2476   1              EEPROM_write_word(Alarm_Low, 0);
2477   1              EEPROM_write_byte(Dot_Point,  0);
2478   1              EEPROM_write_byte(Flash_Disp, 0);
2479   1              EEPROM_write_word(Zero_Code,  0);
2480   1              EEPROM_write_byte(Sample_Rate, 3);
2481   1              EEPROM_write_byte(ID_Code,  0);
2482   1              EEPROM_write_word(Lo_Mask, 0);
2483   1              EEPROM_write_byte(Count_Code,  0);
2484   1              EEPROM_write_byte(Gain, 0);
2485   1              EEPROM_write_byte(Transfor, 0);
2486   1              EEPROM_write_word(Disp_Hi, 0);
2487   1              EEPROM_write_byte(Relay,  0);
2488   1              EEPROM_write_byte(Disp_Count, 5);
2489   1              EEPROM_write_byte(Zero_Set,  0);
2490   1              EEPROM_write_byte(Decode_Num,  2);
2491   1              EEPROM_write_byte(Status_flag, 0);
2492   1              EEPROM_write_word(60,0);
2493   1              EEPROM_write_word(EEP_ADR, 64);         //eep start code
2494   1          RTC_ON();
2495   1      }
2496          /*****************************************************/
2497          void DO_RESET_TYPE(void)
2498          {
2499   1           EEPROM_WriteDefault();
2500   1          LED_Fill();                                     //  LED all light
2501   1              C_F_Type =      EEPROM_read_byte(C_F_Select);
2502   1              TC_Type =       EEPROM_read_byte(Type_Select);       //Type define k=0.j=1,t=2
2503   1              Zero_offset =   EEPROM_read_word(Zero); 
2504   1              Span_offset =   EEPROM_read_word(Span);
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 42  

2505   1              Span_Value  =   EEPROM_read_word(Slope);
2506   1          use_year =      EEPROM_read_byte(Year_Date);
2507   1          use_mon =       EEPROM_read_byte(Mon_Date);
2508   1          use_day =       EEPROM_read_byte(Day_Date);
2509   1          use_hour =      EEPROM_read_byte(Hour_Date);
2510   1          use_min =       EEPROM_read_byte(Min_Date);
2511   1          Hi_Disp_Code =  EEPROM_read_word(Hi_Disp);
2512   1          Lo_Disp_Code =  EEPROM_read_word(Lo_Disp);
2513   1          Hi_Input_Code = EEPROM_read_word(Hi_Input);
2514   1          Lo_Input_Code = EEPROM_read_word(Lo_Input);
2515   1              alarm_Hi_set =  EEPROM_read_word(Alarm_Hi);
2516   1              alarm_HH_set =  EEPROM_read_word(Relay_HH);
2517   1              alarm_LL_set =  EEPROM_read_word(Relay_LL);
2518   1              alarm_Low_set = EEPROM_read_word(Alarm_Low);
2519   1              Dot_Addr =      EEPROM_read_byte(Dot_Point);
2520   1              Flash_Time =    EEPROM_read_byte(Flash_Disp);
2521   1              Zero_Add =      EEPROM_read_word(Zero_Code);
2522   1              Uart_Rate =     EEPROM_read_byte(Sample_Rate);
2523   1              Uart_ID =       EEPROM_read_byte(ID_Code);
2524   1              Low_Limit =     EEPROM_read_word(Lo_Mask);
2525   1              Disp_Neg =      EEPROM_read_byte(Count_Code);
2526   1              Disp_Gain =     EEPROM_read_byte(Gain);
2527   1              Uart_tran =     EEPROM_read_byte(Transfor);
2528   1              Hi_Limit =      EEPROM_read_word(Disp_Hi);
2529   1              Relay_ON_OFF =  EEPROM_read_byte(Relay);
2530   1              Disp_Bits =     EEPROM_read_byte(Disp_Count);
2531   1              Disp_Show =     EEPROM_read_byte(Zero_Set);
2532   1              Decode_Bit =    EEPROM_read_byte(Decode_Num);
2533   1          use_flag =      EEPROM_read_byte(Status_flag);
2534   1              Temp_offset  =  EEPROM_read_word(60);
2535   1      //       eep_count = EEPROM_read_byte(EEP_ADR);
2536   1      }
2537          /***********************************
2538          ****      System_Start          ****
2539          ***********************************/ 
2540          main(void)
2541          {
2542   1         TR0 = 0;
2543   1         TMOD = TMOD |= 0x01;
2544   1         TH0  = 0xDC; //use timer0 to delay 5ms
2545   1         TL0  = 0;
2546   1         TF0  = 0; 
2547   1      
2548   1         IFMT = 0x07 ; //#AUXRA_Rd ;set read AUXRA command
2549   1         SCMD = 0x46; //h
2550   1         SCMD = 0xB9; //h
2551   1         IFD  = IFD |= 0x08; //;
2552   1         IFMT = 0x06;  // #AUXRA_Wr ;set write AUXRA command
2553   1         SCMD = 0x46; // #46h
2554   1         SCMD = 0xB9; //h
2555   1         TR0  = 1 ;  //;timer0 run
2556   1       while( ~TF0 ) 
2557   1            {   }
2558   1         TF0 = 0;  //
2559   1         TR0  = 0;          //;timer0 stop
2560   1         IFMT = 0x07 ;      //#AUXRA_Rd ;set read AUXRA command
2561   1         SCMD = 0x46 ;      //h
2562   1         SCMD = 0xB9 ;      //h
2563   1         IFD  = IFD |= 0x03 ;
2564   1         IFMT = 0x06;       // #AUXRA_Wr ;set write AUXRA command
2565   1         SCMD = 0x46;       // h
2566   1         SCMD = 0xB9;       //h
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 43  

2567   1         IFMT = 0x07;       //#AUXRA_Rd ;set read AUXRA command
2568   1         SCMD = 0x46;       //h
2569   1         SCMD = 0xB9;       //h
2570   1         IFD = IFD &= 0xFB; //
2571   1         IFMT = 0x06;       //, #AUXRA_Wr ;set write AUXRA command
2572   1         SCMD = 0x46;       //h
2573   1         SCMD = 0x0B9;      //h
2574   1      
2575   1              P0M0 = 0xFF;      //00=Qb,01=pull output, 10= input only,11=open drain
2576   1              P0M1 = 0x00;     //P0= ALL INPUT  00
2577   1              P0   = 0xff;
2578   1      
2579   1              P1M0 = 0x00;     //P1= ALL OUTPUT//00
2580   1              P1M1 = 0xFF;     //SETUP P1 ALL LO //  define P1.3 P1.4 P1.5 as push-pull
2581   1          P1   = 0x00;
2582   1          
2583   1              P2M0 = 0x24;     //P2= ALL OUTOUT        04 
2584   1              P2M1 = 0xFF;     //SETUP P2 ALL LO       df
2585   1              P2  =  0x00;
2586   1      
2587   1          P3M0 = 0xED;         //     ed  
2588   1              P3M1 = 0x13;     // 13
2589   1              P3   = 0x2C;     // 2c
2590   1      
2591   1              PORT_Init();
2592   1              RTC_SCL = 1;
2593   1              RTC_SDA = 1;
2594   1              EEPROM_Init();
2595   1              LED_Init();
2596   1              T0_Init();
2597   1              T1_Init();
2598   1              AD3421_Init();
2599   1              InitUart();
2600   1          Set_mA(0);
2601   1          LED_Fill();
2602   1              Set_mV(0);
2603   1              Buzzer(0);
2604   1              Soft_Timer_Enable = 0;
2605   1              if((EEPROM_read_byte(0) != 'N')||(EEPROM_read_byte(1) != 'E')||(EEPROM_read_byte(2) != 'W')||(EEPROM_read
             -_byte(3) != JOHNSON)||(EEPROM_read_byte(4) != LIN))
2606   1           {
2607   2                      EEPROM_write_byte(0, 'N');      
2608   2                      EEPROM_write_byte(1, 'E');
2609   2                      EEPROM_write_byte(2, 'W');
2610   2                      EEPROM_write_byte(3, JOHNSON);  
2611   2                      EEPROM_write_byte(4, LIN);
2612   2                      RTC_ON();       
2613   2                      EEPROM_WriteDefault();
2614   2           }
2615   1           LED_Fill(); 
2616   1               C_F_Type =     EEPROM_read_byte(C_F_Select);
2617   1               TC_Type =      EEPROM_read_byte(Type_Select);       //Type define k=0.j=1,t=2
2618   1               Zero_offset =  EEPROM_read_word(Zero); 
2619   1               Span_offset =  EEPROM_read_word(Span);
2620   1               Span_Value  =  EEPROM_read_word(Slope);
2621   1           use_year =     EEPROM_read_byte(Year_Date);
2622   1           use_mon =      EEPROM_read_byte(Mon_Date);
2623   1           use_day =      EEPROM_read_byte(Day_Date);
2624   1           use_hour =     EEPROM_read_byte(Hour_Date);
2625   1           use_min =      EEPROM_read_byte(Min_Date);
2626   1           Hi_Disp_Code =  EEPROM_read_word(Hi_Disp);
2627   1           Lo_Disp_Code =  EEPROM_read_word(Lo_Disp);
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 44  

2628   1           Hi_Input_Code = EEPROM_read_word(Hi_Input);
2629   1           Lo_Input_Code = EEPROM_read_word(Lo_Input);
2630   1              alarm_Hi_set =  EEPROM_read_word(Alarm_Hi);
2631   1              alarm_HH_set =  EEPROM_read_word(Relay_HH);
2632   1              alarm_LL_set =  EEPROM_read_word(Relay_LL);
2633   1              alarm_Low_set = EEPROM_read_word(Alarm_Low);
2634   1          Relay_ON_OFF =  EEPROM_read_byte(Relay);
2635   1              Dot_Addr =      EEPROM_read_byte(Dot_Point);
2636   1              Flash_Time =    EEPROM_read_byte(Flash_Disp);
2637   1              Zero_Add =      EEPROM_read_word(Zero_Code);
2638   1              Uart_Rate =     EEPROM_read_byte(Sample_Rate);  
2639   1              Uart_ID =       EEPROM_read_byte(ID_Code);              
2640   1              Low_Limit =     EEPROM_read_word(Lo_Mask);              
2641   1              Disp_Neg =      EEPROM_read_byte(Count_Code);  //
2642   1              Disp_Gain =     EEPROM_read_byte(Gain);
2643   1              Uart_tran =     EEPROM_read_byte(Transfor);        
2644   1              Hi_Limit =      EEPROM_read_word(Disp_Hi);
2645   1              Disp_Bits =     EEPROM_read_byte(Disp_Count); 
2646   1              Disp_Show =     EEPROM_read_byte(Zero_Set);
2647   1              Decode_Bit =    EEPROM_read_byte(Decode_Num);   //
2648   1          use_flag =      EEPROM_read_byte(Status_flag);
2649   1              Temp_offset  =  EEPROM_read_word(60);
2650   1      //      eep_count = EEPROM_read_byte(EEP_ADR);
2651   1              Disp_year = use_year+0x2000;
2652   1              RTC_ON();
2653   1       
2654   1               ET0 = 1;
2655   1               TR0 = 1;
2656   1               ET1 = 1;
2657   1               TR1 = 1;
2658   1               EA  = 1;
2659   1               MAIN_SW = 1 ;
2660   1      
2661   1           Check_PCB();
2662   1      
2663   1              if(Work_Type == 0)
2664   1                { if(use_flag & 0x01) NG_COD = 1 ;}
2665   1              else if(Work_Type == 1)
2666   1                { if(use_flag & 0x02) NG_COD = 1 ;}
2667   1              else if(Work_Type == 2)
2668   1                { if(use_flag &0x04)  NG_COD = 1 ;}
2669   1              else if(Work_Type == 3)
2670   1                { if(use_flag & 0x08) NG_COD = 1 ;}
2671   1      //***************************************
2672   1              while (1)
2673   1              {
2674   2                      switch (Func_Type)
2675   2                        {
2676   3                              case TC_FUNCTION:
2677   3                          if(Work_Type == 0)
2678   3                            { if(use_flag & 0x10) {ADD_COD = 1;}else{ADD_COD = 0;}}
2679   3                                      DO_TC_TYPE();
2680   3                                      break;
2681   3      
2682   3                              case RTD_FUNCTION:
2683   3                              DO_RTD_TYPE();
2684   3                                      break;
2685   3      
2686   3                              case mV_FUNCTION:
2687   3                                      DO_mV_TYPE();
2688   3                                      break;
2689   3      
C51 COMPILER V9.02   MAIN                                                                  07/30/2015 20:58:16 PAGE 45  

2690   3                              case mA_FUNCTION:
2691   3                                  DO_mA_TYPE();
2692   3                                      break;
2693   3                              
2694   3                              case SETUP_FUNCTION:
2695   3                                              CAIT = 1 ;
2696   3                                      DO_SETUP_TYPE();
2697   3                              
2698   3                                      break;
2699   3      
2700   3                              case CLEAR_FUNCTION:
2701   3                                      DO_RESET_TYPE();
2702   3                                      break;
2703   3                     }
2704   2               }
2705   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  13146    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     58      32
   IDATA SIZE       =     82    ----
   BIT SIZE         =      3    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
